<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PROPELLINI – Премиальная оклейка автомобилей защитной пленкой</title>
  <!-- Mobile fixes applied -->
  <meta name="description" content="Профессиональная оклейка автомобилей антигравийной пленкой в Москве. Премиум качество, гарантия, лучшие материалы." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:wght@400;500&family=Unbounded:wght@400;500;600;700;800;900&display=swap&subset=cyrillic,latin" rel="stylesheet">
  <link rel="stylesheet" href="src/styles/fonts.css" />
  <link rel="stylesheet" href="src/styles/main.css" />
  <link rel="stylesheet" href="src/styles/responsive-bg.css" />
  <link rel="stylesheet" href="src/styles/animations.css" />
  <link rel="stylesheet" href="src/styles/mobile-premium.css" />
  <link rel="stylesheet" href="src/styles/mobile-fixes.css" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
</head>
<body>
  <div class="noise-layer"></div>
  
  <!-- Navigation -->
  <nav class="main-nav" id="mainNav">
    <div class="nav-container">
      <div class="nav-logo">
        <img src="public/logo/icon-black.png" alt="Propellini" class="nav-logo-icon" />
        <span class="nav-logo-text">PROPELLINI</span>
      </div>
      <button class="nav-toggle" id="navToggle" aria-label="Меню" tabindex="0">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <ul class="nav-menu" id="navMenu">
        <li><a href="#hero" tabindex="0">Главная</a></li>
        <li><a href="#benefits" tabindex="0">Преимущества</a></li>
        <li><a href="#about" tabindex="0">О нас</a></li>
        <li><a href="#services" tabindex="0">Услуги</a></li>
        <li><a href="#" id="calculatorNavBtn" tabindex="0">Калькулятор</a></li>
        <li><a href="#films" tabindex="0">Пленки</a></li>
        <li><a href="#process" tabindex="0">Процесс</a></li>
        <li><a href="#portfolio" tabindex="0">Портфолио</a></li>
        <li><a href="#reviews" tabindex="0">Отзывы</a></li>
        <li><a href="#contacts" tabindex="0">Контакты</a></li>
      </ul>
    </div>
  </nav>

  <!-- 1. HERO SECTION -->
  <section class="hero hero-section responsive-bg premium-bg-overlay premium-processed parallax-image" id="hero" data-bg-desktop="/public/images/hero/hero-desktop.jpg" data-bg-mobile="/public/images/hero/hero-mobile.jpg">
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <h1 class="hero-title">Оклейка<br>автомобиля<br>защитной пленкой</h1>
      <div class="hero-promo">
        <p class="hero-promo-text">Скидка 50% на броню лобового<br>стекла при полной оклейке кузова</p>
        <a href="#contacts" class="btn btn-primary discount-open-btn" tabindex="0">Получить скидку</a>
      </div>
      <div class="hero-pricing">
        <p class="hero-pricing-item">Оклейка зон риска от <strong>25 000 ₽</strong></p>
        <p class="hero-pricing-item">Оклейка кузова целиком от <strong>180 000 ₽</strong></p>
      </div>
      <div class="hero-cta">
        <a href="#" class="btn btn-primary calculator-open-btn" id="heroCalculatorBtn" tabindex="0">Рассчитать стоимость</a>
        <a href="#portfolio" class="btn btn-secondary" tabindex="0">Наши работы</a>
      </div>
      <div class="hero-contacts">
        <a href="tel:+79919361489" class="hero-phone">+7(991)936-14-89</a>
        <a href="mailto:info@proppelini.ru" class="hero-email">info@proppelini.ru</a>
        <p class="hero-address">Москва, ул. Авиационная, 79 к. 1</p>
      </div>
    </div>
    <div class="hero-scroll-indicator">
      <span>Прокрутите вниз</span>
      <div class="scroll-arrow"></div>
    </div>
  </section>

  <!-- 2. UTP / BENEFITS SECTION -->
  <section class="benefits" id="benefits">
    <div class="container">
      <h2 class="section-title">Почему выбирают PROPELLINI</h2>
      <div class="benefits-grid">
        <div class="benefit-card-glass" data-animate="fade-up">
          <div class="benefit-glass-content">
            <h3 class="benefit-glass-title">Премиум материалы</h3>
            <p class="benefit-glass-text">Только сертифицированные пленки мировых брендов</p>
          </div>
        </div>
        <div class="benefit-card-glass" data-animate="fade-up">
          <div class="benefit-glass-content">
            <h3 class="benefit-glass-title">Гарантия качества</h3>
            <p class="benefit-glass-text">Официальная гарантия на все виды работ</p>
          </div>
        </div>
        <div class="benefit-card-glass" data-animate="fade-up">
          <div class="benefit-glass-content">
            <h3 class="benefit-glass-title">Опытные мастера</h3>
            <p class="benefit-glass-text">Команда профессионалов с многолетним опытом</p>
          </div>
        </div>
        <div class="benefit-card-glass" data-animate="fade-up">
          <div class="benefit-glass-content">
            <h3 class="benefit-glass-title">Современное оборудование</h3>
            <p class="benefit-glass-text">Используем передовые технологии и инструменты</p>
          </div>
        </div>
        <div class="benefit-card-glass" data-animate="fade-up">
          <div class="benefit-glass-content">
            <h3 class="benefit-glass-title">Быстрые сроки</h3>
            <p class="benefit-glass-text">Выполняем работы в оговоренные сроки</p>
          </div>
        </div>
        <div class="benefit-card-glass" data-animate="fade-up">
          <div class="benefit-glass-content">
            <h3 class="benefit-glass-title">Индивидуальный подход</h3>
            <p class="benefit-glass-text">Учитываем все пожелания клиента</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 3. ABOUT PROPELLINI SECTION -->
  <section class="about" id="about">
    <div class="about-background about-section responsive-bg premium-bg-overlay-strong premium-processed" data-bg-desktop="/public/images/about/about-desktop.jpg" data-bg-mobile="/public/images/about/about-mobile.jpg">
      <div class="about-overlay"></div>
    </div>
    <div class="container">
      <div class="about-content" data-animate="slide-left">
        <h2 class="section-title">О PROPELLINI</h2>
        <p class="about-text">Премиальная студия оклейки автомобилей защитной пленкой в Москве. Профессиональная защита кузова с использованием лучших материалов и технологий. Многолетний опыт работы с премиальными автомобилями.</p>
      </div>
      
      <!-- Achievement Cards -->
      <div class="about-achievements">
        <div class="achievement-card" data-animate="fade-up">
          <div class="achievement-number">12+</div>
          <div class="achievement-label">лет опыта в оклейке защитной пленкой</div>
        </div>
        <div class="achievement-card" data-animate="fade-up">
          <div class="achievement-number">300+</div>
          <div class="achievement-label">автомобилей оклеиваем ежегодно</div>
        </div>
        <div class="achievement-card" data-animate="fade-up">
          <div class="achievement-number">10</div>
          <div class="achievement-label">лет гарантии на пленку премиум-класса</div>
        </div>
        <div class="achievement-card" data-animate="fade-up">
          <div class="achievement-number">100%</div>
          <div class="achievement-label">сертифицированные мастера с обучением</div>
        </div>
      </div>

      <!-- Promo Block -->
      <div class="about-promo" data-animate="fade-up">
        <div class="promo-content">
          <h3 class="promo-title">Скидка 50% на броню лобового стекла</h3>
          <p class="promo-subtitle">при полной оклейке кузова</p>
          <a href="#contacts" class="btn btn-primary promo-btn discount-open-btn" tabindex="0">Получить скидку</a>
        </div>
      </div>
    </div>
  </section>

  <!-- 4. SERVICE PACKAGES SECTION -->
  <section class="services" id="services">
    <div class="container">
      <h2 class="section-title">Пакеты услуг</h2>
      <div class="services-grid">
        <div class="service-card" data-animate="fade-up">
          <div class="service-badge">Базовый</div>
          <h3>Зоны риска</h3>
          <p>Защита наиболее уязвимых элементов кузова</p>
          <ul class="service-features">
            <li>Капот</li>
            <li>Бамперы</li>
            <li>Зеркала</li>
            <li>Пороги</li>
          </ul>
          <a href="#" class="btn btn-primary calculator-open-btn" tabindex="0">Рассчитать</a>
        </div>
        <div class="service-card service-card-featured" data-animate="fade-up">
          <div class="service-badge">Премиум</div>
          <h3>Полная оклейка</h3>
          <p>Комплексная защита всего кузова автомобиля</p>
          <ul class="service-features">
            <li>Все элементы кузова</li>
            <li>Премиум материалы</li>
            <li>Гарантия 5 лет</li>
            <li>Бесплатная диагностика</li>
          </ul>
          <a href="#" class="btn btn-primary calculator-open-btn" tabindex="0">Рассчитать</a>
        </div>
        <div class="service-card" data-animate="fade-up">
          <div class="service-badge">Люкс</div>
          <h3>Премиум пакет</h3>
          <p>Максимальная защита с дополнительными услугами</p>
          <ul class="service-features">
            <li>Полная оклейка</li>
            <li>Керамическое покрытие</li>
            <li>Гарантия 7 лет</li>
            <li>Пожизненная поддержка</li>
          </ul>
          <a href="#" class="btn btn-primary calculator-open-btn" tabindex="0">Рассчитать</a>
        </div>
      </div>
    </div>
  </section>

  <!-- 5. CALCULATOR SECTION -->
  <section class="calculator-section" id="calculator">
    <button class="calculator-close-btn" id="calculatorCloseBtn" aria-label="Закрыть калькулятор" tabindex="0">&times;</button>
    <div class="container">
      <h2 class="section-title">Калькулятор стоимости</h2>
      <p class="section-subtitle">Выберите автомобиль и зоны оклейки для расчета стоимости</p>
      
      <!-- Desktop Calculator -->
      <div class="calculator-desktop" id="calculatorDesktop">
        <div class="calculator">
          <header class="calculator-header">
            <div class="address"><strong>Москва, ул. Пришвина, вл2А</strong></div>
            <h3>PROPELLINI</h3>
            <p class="subtitle">Калькулятор оклейки антигравийной пленкой</p>
          </header>

          <div class="calculator-content">
            <aside class="left-column">
              <section class="car-class-selection card">
                <h2>Выбрать тип авто</h2>
                <div class="class-options" id="classOptions">
                  <button class="class-option active" data-class="small" tabindex="0"><span class="thumb"></span><div class="class-info"><h3>Малый класс</h3></div></button>
                  <button class="class-option" data-class="business" tabindex="0"><span class="thumb"></span><div class="class-info"><h3>Бизнес класс / Кроссоверы</h3></div></button>
                  <button class="class-option" data-class="suv-lux" tabindex="0"><span class="thumb"></span><div class="class-info"><h3>Внедорожники / Люкс</h3></div></button>
                  <button class="class-option" data-class="pickup" tabindex="0"><span class="thumb"></span><div class="class-info"><h3>Большие пикапы</h3></div></button>
                  <button class="class-option" data-class="bus" tabindex="0"><span class="thumb"></span><div class="class-info"><h3>Автобусы / Минивэны</h3></div></button>
                </div>
              </section>

              <section class="model-selection card">
                <h2>Выбор марки и модели</h2>
                <div class="search-container">
                  <input type="text" id="modelSearch" placeholder="Начните вводить марку или модель…" tabindex="0" />
                  <div class="dropdown" id="modelDropdown"></div>
                </div>
                <div class="brands-chips-container">
                  <h3 class="chips-title">Выберите марку:</h3>
                  <div class="chips-wrapper" id="brandChips"></div>
                </div>
                <div class="models-chips-container">
                  <h3 class="chips-title">Выберите модель:</h3>
                  <div class="chips-wrapper" id="modelChips"></div>
                </div>
                <div class="selected-model" id="selectedModelInfo" style="display:none;">
                  <span id="modelName"></span>
                  <span class="model-class" id="modelClass"></span>
                </div>
              </section>

              <section class="contacts-section card">
                <h3>Заказать звонок</h3>
                <div class="phone-number">8 (968) 811-66-88</div>
                <p class="phone-subtitle">По всем вопросам</p>
              </section>
            </aside>

            <section class="right-column">
              <section class="zones-selection card" id="zonesSelection">
                <h2>Выбрать область оклейки</h2>
                <div class="quick-buttons">
                  <button id="riskZonesBtn" class="quick-btn" tabindex="0">Оклейка зон риска</button>
                  <button id="fullWrapBtn" class="quick-btn" tabindex="0">Полная оклейка кузова</button>
                  <button id="clearZonesBtn" class="quick-btn" tabindex="0">Сбросить</button>
                </div>
                <div class="car-zones-visual" id="car3dContainer">
                  <div id="car3dCanvas"></div>
                  <div class="car-3d-hint">
                    <span>Вращать мышью | Зум колесиком</span>
                  </div>
                </div>
                <div id="carSvgFallback" style="display: none;">
                  <svg viewBox="0 0 400 450" width="100%" height="auto">
                    <g id="interactive-zones"></g>
                  </svg>
                </div>
              </section>

              <section class="total-section card">
                <div class="total-header"><h2>Итоговая стоимость</h2></div>
                <div class="total-details">
                  <div class="total-info">
                    <span id="totalZones">0 зон</span>
                    <span id="carClassInfo">Класс не выбран</span>
                  </div>
                  <div class="total-price"><span class="total-amount" id="totalAmount">0 ₽</span></div>
                </div>
                <button class="order-btn" id="orderBtn" tabindex="0">Записаться на оклейку</button>
                
                <!-- Application Form inside Calculator -->
                <div class="calculator-application-form" id="calculatorApplicationForm" style="display: none;">
                  <form id="calculatorOrderForm" class="calculator-order-form">
                  <div class="application-form-header">
                    <h3>Записаться на оклейку</h3>
                    <button type="button" class="application-form-close" id="calculatorFormClose" aria-label="Закрыть">&times;</button>
                  </div>
                    <div class="form-group">
                      <label for="calcOrderName">Ваше имя *</label>
                      <input type="text" id="calcOrderName" name="name" required placeholder="Введите ваше имя" tabindex="0" />
                    </div>
                    <div class="form-group">
                      <label for="calcOrderPhone">Телефон *</label>
                      <input type="tel" id="calcOrderPhone" name="phone" required placeholder="+7 (___) ___-__-__" tabindex="0" />
                    </div>
                    <div class="form-group">
                      <label for="calcOrderEmail">Email</label>
                      <input type="email" id="calcOrderEmail" name="email" placeholder="email@example.com" tabindex="0" />
                    </div>
                    <div class="form-group">
                      <label for="calcOrderCar">Автомобиль</label>
                      <input type="text" id="calcOrderCar" name="car" readonly placeholder="Не выбран" tabindex="0" />
                    </div>
                    <div class="form-group">
                      <label for="calcOrderServices">Выбранные услуги</label>
                      <textarea id="calcOrderServices" name="services" readonly rows="3" placeholder="Не выбраны" tabindex="0"></textarea>
                    </div>
                    <div class="form-group">
                      <label for="calcOrderTotal">Итоговая стоимость</label>
                      <input type="text" id="calcOrderTotal" name="total" readonly placeholder="0 ₽" tabindex="0" />
                    </div>
                    <div class="form-group">
                      <label for="calcOrderComment">Комментарий</label>
                      <textarea id="calcOrderComment" name="comment" rows="3" placeholder="Дополнительная информация" tabindex="0"></textarea>
                    </div>
                    <div class="form-actions">
                      <button type="button" class="btn btn-outline" id="calcOrderCancel" tabindex="0">Отмена</button>
                      <button type="submit" class="btn btn-primary" tabindex="0">Отправить заявку</button>
                    </div>
                  </form>
                </div>
              </section>
            </section>
          </div>
        </div>
      </div>

      <!-- Mobile Calculator Wizard - ПРЕМИУМ ПЕРЕРАБОТАННАЯ ВЕРСИЯ -->
      <div class="calculator-mobile" id="calculatorMobile">
        <div class="mobile-wizard-new">
          <!-- Шаг 0: Выбор класса автомобиля -->
          <div class="mobile-wizard-step active" data-step="0">
            <h3 class="mobile-step-title">Выберите тип авто</h3>
            <div class="mobile-class-selection" id="mobileClassSelection">
              <!-- Классы будут здесь -->
            </div>
          </div>
          
          <!-- Шаг 1: Выбор марки -->
          <div class="mobile-wizard-step" data-step="1">
            <h3 class="mobile-step-title">Выберите марку автомобиля</h3>
            <div class="mobile-search-box">
              <input type="text" id="mobileBrandSearch" placeholder="Поиск марки или выберите ниже..." autocomplete="off" />
            </div>
            <div class="mobile-chips-hint">Или выберите из списка:</div>
            <div class="mobile-chips-scroll" id="mobileBrandsChips">
              <!-- Горизонтальные чипсы марок будут здесь -->
            </div>
          </div>

          <!-- Шаг 2: Выбор модели -->
          <div class="mobile-wizard-step" data-step="2">
            <h3 class="mobile-step-title">Выберите модель</h3>
            <div class="mobile-selected-brand" id="mobileSelectedBrand"></div>
            <div class="mobile-class-badge" id="mobileClassBadge" style="display: none;">
              <span class="badge-label">Класс:</span>
              <span class="badge-value" id="mobileClassName"></span>
            </div>
            <div class="mobile-search-box">
              <input type="text" id="mobileModelSearch" placeholder="Поиск модели или выберите ниже..." autocomplete="off" />
            </div>
            <div class="mobile-chips-hint">Или выберите из списка:</div>
            <div class="mobile-chips-scroll" id="mobileModelsChips">
              <!-- Горизонтальные чипсы моделей будут здесь -->
            </div>
          </div>

          <!-- Шаг 3: Выбор услуги -->
          <div class="mobile-wizard-step" data-step="3">
            <h3 class="mobile-step-title">Выберите услугу</h3>
            <div class="mobile-selected-car" id="mobileSelectedCar"></div>
            
            <!-- Пакеты услуг -->
            <div class="mobile-packages-section" id="mobilePackagesSection">
              <h4 class="mobile-section-subtitle">Пакеты услуг</h4>
              <div class="mobile-packages-grid" id="mobilePackagesGrid">
                <!-- Пакеты будут здесь -->
              </div>
            </div>

            <!-- Или зоны вручную -->
            <div class="mobile-zones-section" id="mobileZonesSection">
              <h4 class="mobile-section-subtitle">Выбрать зоны вручную</h4>
              <div class="mobile-zones-list" id="mobileZonesList">
                <!-- Зоны будут здесь -->
              </div>
            </div>

            <!-- Итоговая стоимость и кнопка "Записаться на оклейку" -->
            <div class="mobile-step-3-total" style="margin-top: var(--space-lg); padding: var(--space-md); background: rgba(22, 132, 145, 0.1); border-radius: 12px; text-align: center;">
              <div style="font-size: 14px; color: var(--text-muted); margin-bottom: var(--space-xs);">Итоговая стоимость:</div>
              <div id="mobileStep3Total" style="font-size: 28px; font-weight: 800; color: var(--primary);">0 ₽</div>
            </div>
            
            <div class="mobile-step-3-actions" style="margin-top: var(--space-lg);">
              <button type="button" class="mobile-order-btn" id="mobileStep3OrderBtn" style="display: none; width: 100%; padding: var(--space-md); font-size: 16px; font-weight: 600;">
                Записаться на оклейку
              </button>
            </div>
          </div>

          <!-- Шаг 4: Итог и форма заказа -->
          <div class="mobile-wizard-step" data-step="4">
            <h3 class="mobile-step-title">Проверьте данные</h3>
            <div class="mobile-summary-card">
              <div class="mobile-summary-item">
                <span class="summary-label">Марка:</span>
                <span class="summary-value" id="summaryBrand">—</span>
              </div>
              <div class="mobile-summary-item">
                <span class="summary-label">Модель:</span>
                <span class="summary-value" id="summaryModel">—</span>
              </div>
              <div class="mobile-summary-item">
                <span class="summary-label">Класс:</span>
                <span class="summary-value" id="summaryClass">—</span>
              </div>
              <div class="mobile-summary-item">
                <span class="summary-label">Услуга:</span>
                <span class="summary-value" id="summaryService">—</span>
              </div>
              <div class="mobile-summary-total">
                <span class="summary-label">Итого:</span>
                <span class="summary-value-total" id="summaryTotal">0 ₽</span>
              </div>
            </div>
            
            <!-- Форма заказа -->
            <div class="mobile-order-form-container">
              <h4 class="mobile-form-title">Оставить заявку</h4>
              <form id="mobileOrderForm" class="mobile-order-form">
                <div class="mobile-form-group">
                  <label for="mobileOrderName">Ваше имя *</label>
                  <input type="text" id="mobileOrderName" name="name" required placeholder="Введите ваше имя" />
                </div>
                <div class="mobile-form-group">
                  <label for="mobileOrderPhone">Телефон *</label>
                  <input type="tel" id="mobileOrderPhone" name="phone" required placeholder="+7 (___) ___-__-__" />
                </div>
                <div class="mobile-form-group">
                  <label for="mobileOrderEmail">Email</label>
                  <input type="email" id="mobileOrderEmail" name="email" placeholder="email@example.com" />
                </div>
                <div class="mobile-form-group">
                  <label for="mobileOrderCar">Автомобиль</label>
                  <input type="text" id="mobileOrderCar" name="car" readonly placeholder="Не выбран" />
                </div>
                <div class="mobile-form-group">
                  <label for="mobileOrderServices">Выбранные услуги</label>
                  <textarea id="mobileOrderServices" name="services" readonly rows="2" placeholder="Не выбраны"></textarea>
                </div>
                <div class="mobile-form-group">
                  <label for="mobileOrderTotal">Итоговая стоимость</label>
                  <input type="text" id="mobileOrderTotal" name="total" readonly placeholder="0 ₽" />
                </div>
                <div class="mobile-form-group">
                  <label for="mobileOrderComment">Комментарий</label>
                  <textarea id="mobileOrderComment" name="comment" rows="3" placeholder="Дополнительная информация"></textarea>
                </div>
                <button type="submit" class="mobile-order-btn" id="mobileOrderSubmitBtn">
                  Отправить заявку
            </button>
                <p class="mobile-form-privacy">Нажимая кнопку "Отправить заявку", вы соглашаетесь с политикой конфиденциальности.</p>
              </form>
            </div>
          </div>

          <!-- Фиксированная нижняя панель -->
          <div class="mobile-wizard-footer">
            <button class="mobile-footer-btn mobile-footer-prev" id="mobileFooterPrev" style="display: none;">
              Назад
            </button>
            <div class="mobile-footer-total">
              <span class="footer-total-label">ИТОГО:</span>
              <span class="footer-total-value" id="mobileFooterTotal">0 ₽</span>
            </div>
            <button class="mobile-footer-btn mobile-footer-next" id="mobileFooterNext" style="display: none;">
              Далее
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 6. FILMS SECTION -->
  <section class="films" id="films">
    <div class="films-background premium-bg-overlay-strong" data-speed="0.3">
      <div class="films-overlay"></div>
    </div>
    <div class="container">
      <h2 class="section-title">Премиальные пленки</h2>
      <p class="section-subtitle">Защита и стиль в одном решении</p>
      <p class="films-description">Доступны различные варианты пленок, чтобы вы могли выбрать оптимальную:</p>
      
      <div class="films-glass-container">
        <div class="films-glass-track" id="filmsGlassTrack">
          <div class="film-glass-item" data-film="quantum">
            <span class="film-glass-text">QUANTUM</span>
          </div>
          <div class="film-glass-item" data-film="llumar">
            <span class="film-glass-text">LLUMAR</span>
          </div>
          <div class="film-glass-item" data-film="krytex">
            <span class="film-glass-text">Krytex</span>
          </div>
          <div class="film-glass-item" data-film="monoppf">
            <span class="film-glass-text">MONOPPF</span>
          </div>
          <div class="film-glass-item" data-film="stek">
            <span class="film-glass-text">STEK</span>
          </div>
          <div class="film-glass-item" data-film="formulaone">
            <span class="film-glass-text">Formula one</span>
          </div>
        </div>
      </div>

      <div class="films-benefits">
        <p class="films-benefits-text">Выбор качественных пленок для оклейки – это первый шаг к улучшению внешнего вида вашего автомобиля и его защиты. Каждая из представленных пленок обладает уникальными характеристиками:</p>
        <div class="films-benefits-grid" id="filmsBenefitsGrid">
          <div class="films-benefit-item">
            <span class="films-benefit-icon">✓</span>
            <span>Защита от УФ-лучей</span>
          </div>
          <div class="films-benefit-item">
            <span class="films-benefit-icon">✓</span>
            <span>Терморегуляция</span>
          </div>
          <div class="films-benefit-item">
            <span class="films-benefit-icon">✓</span>
            <span>Антибликовая защита</span>
          </div>
          <div class="films-benefit-item">
            <span class="films-benefit-icon">✓</span>
            <span>Эстетика и стиль</span>
          </div>
          <div class="films-benefit-item">
            <span class="films-benefit-icon">✓</span>
            <span>Прочность</span>
          </div>
          <div class="films-benefit-item">
            <span class="films-benefit-icon">✓</span>
            <span>Матовые и глянцевые текстуры</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 7. PROCESS SECTION -->
  <section class="process" id="process">
    <div class="container">
      <h2 class="section-title">Процесс работы</h2>
      <div class="process-steps-compact">
        <div class="process-step-compact" data-animate="fade-up">
          <div class="process-number-compact">01</div>
          <div class="process-content-compact">
            <h3>Консультация</h3>
            <p>Обсуждение потребностей и выбор решения</p>
          </div>
        </div>
        <div class="process-step-compact" data-animate="fade-up">
          <div class="process-number-compact">02</div>
          <div class="process-content-compact">
            <h3>Осмотр</h3>
            <p>Оценка состояния кузова</p>
          </div>
        </div>
        <div class="process-step-compact" data-animate="fade-up">
          <div class="process-number-compact">03</div>
          <div class="process-content-compact">
            <h3>Подготовка</h3>
            <p>Мойка и обезжиривание</p>
          </div>
        </div>
        <div class="process-step-compact" data-animate="fade-up">
          <div class="process-number-compact">04</div>
          <div class="process-content-compact">
            <h3>Оклейка</h3>
            <p>Установка защитной пленки</p>
          </div>
        </div>
        <div class="process-step-compact" data-animate="fade-up">
          <div class="process-number-compact">05</div>
          <div class="process-content-compact">
            <h3>Контроль</h3>
            <p>Проверка качества</p>
          </div>
        </div>
        <div class="process-step-compact" data-animate="fade-up">
          <div class="process-number-compact">06</div>
          <div class="process-content-compact">
            <h3>Выдача</h3>
            <p>Передача с документами</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 8. PORTFOLIO / GALLERY SECTION -->
  <section class="portfolio" id="portfolio">
    <div class="container">
      <h2 class="section-title">Наши работы</h2>
      <div class="portfolio-gallery" id="portfolioGallery">
        <div class="portfolio-item tilt-3d" data-image="https://i.pinimg.com/736x/1c/9c/9a/1c9c9aff8afe692321467ca5f1d97f32.jpg" data-alt="Работа 1">
          <img src="https://i.pinimg.com/736x/1c/9c/9a/1c9c9aff8afe692321467ca5f1d97f32.jpg" alt="Работа 1" class="gallery-image gallery-image-processed premium-processed" loading="lazy" />
        </div>
        <div class="portfolio-item tilt-3d" data-image="https://i.pinimg.com/1200x/5e/4c/e7/5e4ce70476d2dd1567d432680cc4462a.jpg" data-alt="Работа 2">
          <img src="https://i.pinimg.com/1200x/5e/4c/e7/5e4ce70476d2dd1567d432680cc4462a.jpg" alt="Работа 2" class="gallery-image gallery-image-processed premium-processed" loading="lazy" />
        </div>
        <div class="portfolio-item tilt-3d" data-image="https://i.pinimg.com/736x/7c/c5/dd/7cc5ddc8d2833edc1ad6f3510c7df3d6.jpg" data-alt="Работа 3">
          <img src="https://i.pinimg.com/736x/7c/c5/dd/7cc5ddc8d2833edc1ad6f3510c7df3d6.jpg" alt="Работа 3" class="gallery-image gallery-image-processed premium-processed" loading="lazy" />
        </div>
        <div class="portfolio-item tilt-3d" data-image="https://i.pinimg.com/736x/72/96/1b/72961bc9ff271e5c385c60aa58e22c4b.jpg" data-alt="Работа 4">
          <img src="https://i.pinimg.com/736x/72/96/1b/72961bc9ff271e5c385c60aa58e22c4b.jpg" alt="Работа 4" class="gallery-image gallery-image-processed premium-processed" loading="lazy" />
        </div>
        <div class="portfolio-item tilt-3d" data-image="https://i.pinimg.com/736x/bb/92/82/bb9282a24a432e16a8362c5c62c8c2f8.jpg" data-alt="Работа 5">
          <img src="https://i.pinimg.com/736x/bb/92/82/bb9282a24a432e16a8362c5c62c8c2f8.jpg" alt="Работа 5" class="gallery-image gallery-image-processed premium-processed" loading="lazy" />
        </div>
        <div class="portfolio-item tilt-3d" data-image="https://i.pinimg.com/736x/92/20/03/9220033bd92d57ab5a371f0bead58dbb.jpg" data-alt="Работа 6">
          <img src="https://i.pinimg.com/736x/92/20/03/9220033bd92d57ab5a371f0bead58dbb.jpg" alt="Работа 6" class="gallery-image gallery-image-processed premium-processed" loading="lazy" />
        </div>
        <div class="portfolio-item tilt-3d" data-image="https://i.pinimg.com/736x/8c/c1/23/8cc12382dd904e89e24dfd9216f8180b.jpg" data-alt="Работа 7">
          <img src="https://i.pinimg.com/736x/8c/c1/23/8cc12382dd904e89e24dfd9216f8180b.jpg" alt="Работа 7" class="gallery-image gallery-image-processed premium-processed" loading="lazy" />
        </div>
        <div class="portfolio-item tilt-3d" data-image="https://i.pinimg.com/736x/40/98/39/409839f150de67d23e274ebea1369bab.jpg" data-alt="Работа 8">
          <img src="https://i.pinimg.com/736x/40/98/39/409839f150de67d23e274ebea1369bab.jpg" alt="Работа 8" class="gallery-image gallery-image-processed premium-processed" loading="lazy" />
        </div>
      </div>
      
      <!-- Lightbox Modal для галереи -->
      <div id="portfolioLightbox" class="portfolio-lightbox" style="display: none;">
        <div class="lightbox-overlay" id="lightboxOverlay"></div>
        <button class="lightbox-close" id="lightboxClose" aria-label="Закрыть">&times;</button>
        <button class="lightbox-prev" id="lightboxPrev" aria-label="Предыдущее изображение">‹</button>
        <button class="lightbox-next" id="lightboxNext" aria-label="Следующее изображение">›</button>
        <div class="lightbox-content">
          <img id="lightboxImage" src="" alt="" />
          <div class="lightbox-caption" id="lightboxCaption"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- 9. TEASER VIDEO SECTION -->
  <section class="video-section" id="video">
    <!-- Desktop video - Rutube iframe -->
    <div class="video-background video-desktop" id="videoDesktopContainer">
      <div class="video-rutube-container" id="videoRutubeContainer" style="display: none;">
        <iframe 
          id="rutubeVideoFrame"
          src="https://rutube.ru/play/embed/081e1943d679395a563ac2325dd3e58b" 
          frameborder="0" 
          allow="clipboard-write; autoplay" 
          webkitAllowFullScreen 
          mozallowfullscreen 
          allowFullScreen
          style="width: 100%; height: 100%; min-height: 600px; border-radius: 12px;">
        </iframe>
      </div>
      <!-- Fallback для старых браузеров -->
      <video id="desktopVideo" muted loop playsinline class="premium-processed" preload="metadata" webkit-playsinline style="display: none;">
        <source src="./public/images/video/teaser-desktop.mp4" type="video/mp4" />
        Ваш браузер не поддерживает видео.
      </video>
    </div>
    <!-- Mobile video - Rutube iframe -->
    <div class="video-background video-mobile" id="videoMobileContainer">
      <div class="video-rutube-container-mobile">
        <iframe 
          src="https://rutube.ru/play/embed/081e1943d679395a563ac2325dd3e58b" 
          frameborder="0" 
          allow="clipboard-write; autoplay" 
          webkitAllowFullScreen 
          mozallowfullscreen 
          allowFullScreen
          style="width: 100%; height: 100%; min-height: 400px; border-radius: 12px;">
        </iframe>
      </div>
    </div>
    <div class="video-overlay premium-bg-overlay" id="videoOverlay"></div>
    <div class="video-content" id="videoContent">
      <h2 class="section-title">Профессионализм в деталях</h2>
      <p class="video-description">Посмотрите, как мы работаем</p>
      <button class="btn btn-primary video-play-btn" id="videoPlayBtn" tabindex="0">Смотреть видео</button>
    </div>
  </section>

  <!-- 10. REVIEWS SECTION -->
  <section class="reviews" id="reviews">
    <div class="container">
      <h2 class="section-title">Отзывы клиентов</h2>
      <div class="reviews-slider" id="reviewsSlider">
        <a href="https://yandex.by/maps/org/propellini/67952230417/reviews/?ll=37.448465%2C55.807461&utm_source=review&z=17" target="_blank" rel="noopener noreferrer" class="review-card review-card-link">
          <div class="review-stars">★★★★★</div>
          <p class="review-text">"Оклеивали полностью кузов защитной пленкой. Работа выполнена на высшем уровне, без единого пузыря. Мастера очень внимательные, все объяснили по процессу. Автомобиль выглядит как новый!"</p>
          <div class="review-author">
            <strong>Александр М.</strong>
            <span>BMW X5</span>
          </div>
          <div class="review-link-hint">Читать на Яндекс →</div>
        </a>
        <a href="https://yandex.by/maps/org/propellini/67952230417/reviews/?ll=37.448465%2C55.807461&utm_source=review&z=17" target="_blank" rel="noopener noreferrer" class="review-card review-card-link">
          <div class="review-stars">★★★★★</div>
          <p class="review-text">"Обратился в Propellini по рекомендации. Не пожалел ни секунды! Качество материалов отличное, установка идеальная. Прошло уже полгода - пленка как новая, никаких дефектов."</p>
          <div class="review-author">
            <strong>Дмитрий К.</strong>
            <span>Mercedes-Benz S-Class</span>
          </div>
          <div class="review-link-hint">Читать на Яндекс →</div>
        </a>
        <a href="https://yandex.by/maps/org/propellini/67952230417/reviews/?ll=37.448465%2C55.807461&utm_source=review&z=17" target="_blank" rel="noopener noreferrer" class="review-card review-card-link">
          <div class="review-stars">★★★★★</div>
          <p class="review-text">"Премиум сервис! От консультации до готового результата - все на высоте. Использовали пленку Quantum, результат превзошел ожидания. Студия чистая, оборудование современное. Рекомендую!"</p>
          <div class="review-author">
            <strong>Игорь В.</strong>
            <span>Audi Q7</span>
          </div>
          <div class="review-link-hint">Читать на Яндекс →</div>
        </a>
        <a href="https://yandex.by/maps/org/propellini/67952230417/reviews/?ll=37.448465%2C55.807461&utm_source=review&z=17" target="_blank" rel="noopener noreferrer" class="review-card review-card-link">
          <div class="review-stars">★★★★★</div>
          <p class="review-text">"Оклеивали капот и передние крылья. Работали аккуратно, все детали защитили. Пленка LLUMAR установлена безупречно. Цена соответствует качеству. Обязательно вернусь для полной оклейки."</p>
          <div class="review-author">
            <strong>Сергей П.</strong>
            <span>Porsche 911</span>
          </div>
          <div class="review-link-hint">Читать на Яндекс →</div>
        </a>
        <a href="https://yandex.by/maps/org/propellini/67952230417/reviews/?ll=37.448465%2C55.807461&utm_source=review&z=17" target="_blank" rel="noopener noreferrer" class="review-card review-card-link">
          <div class="review-stars">★★★★★</div>
          <p class="review-text">"Лучшая студия в Москве! Мастера с большим опытом, работают только с премиум материалами. Оклеили полностью кузов, результат просто потрясающий. Гарантия 10 лет - это говорит о качестве!"</p>
          <div class="review-author">
            <strong>Михаил Р.</strong>
            <span>Range Rover</span>
          </div>
          <div class="review-link-hint">Читать на Яндекс →</div>
        </a>
        <a href="https://yandex.by/maps/org/propellini/67952230417/reviews/?ll=37.448465%2C55.807461&utm_source=review&z=17" target="_blank" rel="noopener noreferrer" class="review-card review-card-link">
          <div class="review-stars">★★★★★</div>
          <p class="review-text">"Оклеивали защитной пленкой весь кузов. Процесс занял 3 дня, но результат того стоил. Никаких подрезов, все идеально. Пленка STEK премиум качества. Спасибо команде Propellini!"</p>
          <div class="review-author">
            <strong>Владимир С.</strong>
            <span>Lexus LX</span>
          </div>
          <div class="review-link-hint">Читать на Яндекс →</div>
        </a>
        <a href="https://yandex.by/maps/org/propellini/67952230417/reviews/?ll=37.448465%2C55.807461&utm_source=review&z=17" target="_blank" rel="noopener noreferrer" class="review-card review-card-link">
          <div class="review-stars">★★★★★</div>
          <p class="review-text">"Заезжал на оклейку машины защитной пленкой. Оказанной услугой остался доволен, ребята профессионалы своего дела. Работа выполнена качественно, все детали на месте. Буду заезжать к ним еще, рекомендую!"</p>
          <div class="review-author">
            <strong>Сергей А.</strong>
            <span>BMW 5 Series</span>
          </div>
          <div class="review-link-hint">Читать на Яндекс →</div>
        </a>
        <a href="https://yandex.by/maps/org/propellini/67952230417/reviews/?ll=37.448465%2C55.807461&utm_source=review&z=17" target="_blank" rel="noopener noreferrer" class="review-card review-card-link">
          <div class="review-stars">★★★★★</div>
          <p class="review-text">"Отличная работа! Оклеили зоны риска на новом автомобиле. Мастера внимательные, все объяснили, показали материалы. Пленка установлена идеально, без единого дефекта. Цены адекватные, качество на высоте!"</p>
          <div class="review-author">
            <strong>Андрей Г.</strong>
            <span>Mercedes-Benz GLE</span>
          </div>
          <div class="review-link-hint">Читать на Яндекс →</div>
        </a>
      </div>
    </div>
  </section>

  <!-- 11. OUR STUDIO SECTION -->
  <section class="studio studio-section-bg responsive-bg premium-bg-overlay premium-processed parallax-image" id="studio" data-speed="0.25" data-bg-desktop="/public/images/studio/studio-1.jpg" data-bg-mobile="/public/images/studio/studio-1.jpg">
    <div class="studio-overlay"></div>
    <div class="studio-haze"></div>
    <div class="container">
      <div class="studio-content" data-animate="fade-up">
        <h2 class="section-title">Наша студия</h2>
        <p class="studio-description">Современное оборудование, просторные боксы, идеальные условия для работы с премиальными автомобилями. PROPELLINI — это не просто сервис, это место, где ваш автомобиль получает премиум-защиту.</p>
        <div class="studio-gallery">
          <div class="studio-gallery-item">
            <div class="studio-gallery-image">
              <img src="https://propellini.ru/wp-content/uploads/2025/09/image_19_.webp" alt="Студия Propellini" loading="lazy" />
            </div>
            <div class="studio-gallery-text">
              <h5>Просторные боксы</h5>
              <p>Достаточно места для комфортной работы</p>
            </div>
          </div>
          <div class="studio-gallery-item">
            <div class="studio-gallery-image">
              <img src="https://propellini.ru/wp-content/uploads/2025/09/5a7627dc3f7e0cf22e40e354b42f9b253f529b88.png" alt="Студия Propellini" loading="lazy" />
            </div>
            <div class="studio-gallery-text">
              <h5>Современное оборудование</h5>
              <p>Используем только лучшее</p>
            </div>
          </div>
          <div class="studio-gallery-item">
            <div class="studio-gallery-image">
              <img src="https://propellini.ru/wp-content/uploads/2025/09/image2-1.png" alt="Студия Propellini" loading="lazy" />
            </div>
            <div class="studio-gallery-text">
              <h5>Идеальные условия</h5>
              <p>Контроль температуры и влажности</p>
            </div>
          </div>
          <div class="studio-gallery-item">
            <div class="studio-gallery-image">
              <img src="https://propellini.ru/wp-content/uploads/2025/09/image_20_.webp" alt="Студия Propellini" loading="lazy" />
            </div>
            <div class="studio-gallery-text">
              <h5>Профессиональные мастера</h5>
              <p>Опытная команда специалистов</p>
            </div>
          </div>
          <div class="studio-gallery-item">
            <div class="studio-gallery-image">
              <img src="https://avatars.mds.yandex.net/get-altay/15437010/2a00000196c526a897764629a6cd0fea968a/XXXL" alt="Студия Propellini" loading="lazy" />
            </div>
            <div class="studio-gallery-text">
              <h5>Премиум материалы</h5>
              <p>Только сертифицированные пленки</p>
            </div>
          </div>
          <div class="studio-gallery-item">
            <div class="studio-gallery-image">
              <img src="https://avatars.mds.yandex.net/get-altay/15081387/2a000001964a643d402c03031ca76c33fd2e/XXXL" alt="Студия Propellini" loading="lazy" />
            </div>
            <div class="studio-gallery-text">
              <h5>Гарантия качества</h5>
              <p>Официальная гарантия на все работы</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 12. CONTACTS SECTION -->
  <section class="contacts" id="contacts">
    <div class="container">
      <div class="contacts-header">
        <h2 class="section-title">Контакты</h2>
        <p class="contacts-description">Вы можете оставить заявку по форме обратной связи или связаться с нами любым другим удобным способом.</p>
      </div>
      
      <div class="contacts-grid">
        <div class="contacts-info">
          <h3 class="contacts-info-title">Центр оклейки защитной пленкой</h3>
          <div class="contacts-brand">Propellini</div>
          <div class="contacts-details">
            <div class="contact-detail-item">
              <strong>Адрес:</strong><br>
              Москва, ул. Авиационная, 79 к. 1
            </div>
            <div class="contact-detail-item">
              <strong>Режим работы:</strong><br>
              пн-вс: с 8:00 до 23:00
            </div>
            <div class="contact-detail-item">
              <strong>Телефон:</strong><br>
              <a href="tel:+79919361489" class="contact-phone">+7 (991) 936-14-89</a>
            </div>
            <div class="contacts-social">
              <a href="https://t.me/propellini_detailing" target="_blank" rel="noopener noreferrer" class="social-link">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.13-.31-1.09-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/>
                </svg>
                Telegram
              </a>
              <a href="https://vk.com/propellini" target="_blank" rel="noopener noreferrer" class="social-link">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12.785 16.241s.336-.041.51-.25c.158-.192.153-.554.153-.554s-.023-1.526.687-1.754c.703-.221 1.604.981 2.562 1.416.724.329 1.274.256 1.274.256l2.559-.038s1.334-.085.7-1.139c-.052-.083-.373-.8-1.916-2.263-1.62-1.534-1.404-1.285.55-3.94.378-.516 1.059-1.354 1.059-1.354s.596-1.129.321-1.631c-.306-.568-.902-.619-.902-.619l-2.476.015s-.549.016-.896.344c-.182.176-.297.439-.297.439s-.534 1.422-1.24 2.633c-1.493 2.493-2.092 2.625-2.336 2.478-.569-.347-.427-1.394-.427-2.139 0-2.325.356-3.297-.695-3.547-.348-.084-.604-.14-1.496-.149-1.143-.012-2.106.004-2.654.28-.377.19-.668.614-.492.638.22.03.718.133.981.483.345.46.332 1.492.332 1.492s.198 2.93-.462 3.289c-.453.247-1.078-.257-2.423-2.633-.688-1.189-1.208-2.5-1.208-2.5s-.1-.32-.279-.492c-.216-.208-.517-.274-.517-.274l-2.345.015s-.78.035-1.067.335c-.257.267-.02.824-.02.824s3.293 7.743 7.014 11.656c3.415 3.607 7.307 3.367 7.307 3.367h1.741z"/>
                </svg>
                ВКонтакте
              </a>
              <a href="https://wa.me/79686648888" target="_blank" rel="noopener noreferrer" class="social-link">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                </svg>
                WhatsApp: +7 968 664-88-88
              </a>
            </div>
          </div>
        </div>
        
        <div class="contacts-form">
          <form id="contactForm" class="contact-form">
            <div class="form-group">
              <input type="text" id="contactName" name="name" required placeholder="Ваше имя *" tabindex="0" />
            </div>
            <div class="form-group">
              <input type="tel" id="contactPhone" name="phone" required placeholder="Ваш телефон *" tabindex="0" />
            </div>
            <div class="form-group">
              <textarea id="contactMessage" name="message" rows="5" placeholder="Сообщение (необязательно)" tabindex="0"></textarea>
            </div>
            <button type="submit" class="btn btn-primary" tabindex="0">Отправить</button>
            <p class="form-privacy">Нажимая кнопку "отправить", вы соглашаетесь с политикой конфиденциальности.</p>
          </form>
        </div>
      </div>
    </div>
  </section>

  <!-- 12.5. MAP SECTION -->
  <section class="map-section" id="map">
    <div class="container">
      <div class="map-container-full">
        <iframe 
          src="https://yandex.ru/map-widget/v1/?text=Москва%2C%20улица%20Авиационная%2C%2079%2C%20корпус%201&z=18&ll=37.5168,55.8021&pt=37.5168,55.8021,pm2rdm&l=map" 
          width="100%" 
          height="100%" 
          frameborder="0" 
          allowfullscreen="true" 
          style="border:0; border-radius: 16px;"
          loading="lazy"
          title="Карта расположения Propellini"
        ></iframe>
      </div>
    </div>
  </section>

  <!-- 13. FOOTER -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-logo">
          <img src="public/logo/icon-black.png" alt="Propellini" class="footer-logo-icon" />
          <span class="footer-logo-text">PROPELLINI</span>
        </div>
        <nav class="footer-nav">
          <a href="#services" tabindex="0">Услуги</a>
          <a href="#reviews" tabindex="0">Отзывы</a>
          <a href="#portfolio" tabindex="0">Портфолио</a>
          <a href="#contacts" tabindex="0">Контакты</a>
        </nav>
        <div class="footer-social">
          <a href="https://www.instagram.com/propellini_detailing" target="_blank" rel="noopener noreferrer" aria-label="Instagram" tabindex="0">Instagram</a>
          <a href="https://t.me/propellini_detailing" target="_blank" rel="noopener noreferrer" aria-label="Telegram" tabindex="0">Telegram</a>
          <a href="https://wa.me/79686648888" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp" tabindex="0">WhatsApp</a>
          <a href="https://vk.com/propellini" target="_blank" rel="noopener noreferrer" aria-label="ВКонтакте" tabindex="0">ВКонтакте</a>
        </div>
      </div>
      <div class="footer-bottom">
        <p>© Propellini, 2025. Все права защищены.</p>
      </div>
    </div>
  </footer>

  <!-- Order Modal -->
  <div id="orderModal" class="order-modal" style="display: none;">
    <div class="order-modal-overlay" id="orderModalOverlay"></div>
    <div class="order-modal-content">
      <button class="order-modal-close" id="orderModalClose" aria-label="Закрыть" tabindex="0">&times;</button>
      <h2>Записаться на оклейку</h2>
      <form id="orderForm" class="order-form">
        <div class="order-form-group">
          <label for="orderName">Ваше имя *</label>
          <input type="text" id="orderName" name="name" required placeholder="Введите ваше имя" tabindex="0" />
        </div>
        <div class="order-form-group">
          <label for="orderPhone">Телефон *</label>
          <input type="tel" id="orderPhone" name="phone" required placeholder="+7 (___) ___-__-__" tabindex="0" />
        </div>
        <div class="order-form-group">
          <label for="orderEmail">Email</label>
          <input type="email" id="orderEmail" name="email" placeholder="email@example.com" tabindex="0" />
        </div>
        <div class="order-form-group" style="display: none;">
          <label for="orderCar">Автомобиль</label>
          <input type="text" id="orderCar" name="car" readonly placeholder="Не выбран" tabindex="0" />
        </div>
        <div class="order-form-group" style="display: none;">
          <label for="orderZones">Выбранные зоны</label>
          <textarea id="orderZones" name="zones" readonly rows="3" placeholder="Не выбраны" tabindex="0"></textarea>
        </div>
        <div class="order-form-group" style="display: none;">
          <label for="orderTotal">Итоговая стоимость</label>
          <input type="text" id="orderTotal" name="total" readonly placeholder="0 ₽" tabindex="0" />
        </div>
        <div class="order-form-group">
          <label for="orderComment">Сообщение (описание)</label>
          <textarea id="orderComment" name="comment" rows="3" placeholder="Дополнительная информация" tabindex="0"></textarea>
        </div>
        <div class="order-form-actions">
          <button type="button" class="order-btn-cancel" id="orderCancel" tabindex="0">Отмена</button>
          <button type="submit" class="order-btn-submit" tabindex="0">Отправить заявку</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Discount Modal - упрощенная форма для получения скидки -->
  <div id="discountModal" class="order-modal" style="display: none;">
    <div class="order-modal-overlay" id="discountModalOverlay"></div>
    <div class="order-modal-content">
      <button class="order-modal-close" id="discountModalClose" aria-label="Закрыть" tabindex="0">&times;</button>
      <h2>Получить скидку</h2>
      <form id="discountForm" class="order-form">
        <div class="order-form-group">
          <label for="discountPhone">Телефон *</label>
          <input type="tel" id="discountPhone" name="phone" required placeholder="+7 (___) ___-__-__" tabindex="0" />
        </div>
        <div class="order-form-group">
          <label for="discountEmail">Email *</label>
          <input type="email" id="discountEmail" name="email" required placeholder="email@example.com" tabindex="0" />
        </div>
        <div class="order-form-group">
          <label for="discountMessage">Сообщение</label>
          <textarea id="discountMessage" name="message" rows="4" placeholder="Ваше сообщение" tabindex="0"></textarea>
        </div>
        <div class="order-form-actions">
          <button type="button" class="order-btn-cancel" id="discountCancel" tabindex="0">Отмена</button>
          <button type="submit" class="order-btn-submit" tabindex="0">Отправить заявку</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="src/utils/responsive-images.js"></script>
  <script src="script.js"></script>
  <script src="animations.js"></script>
  <script>
    // Calculator Toggle Functionality
    const handleCalculatorToggle = () => {
      const calculatorSection = document.getElementById('calculator');
      const calculatorNavBtn = document.getElementById('calculatorNavBtn');
      const calculatorCloseBtn = document.getElementById('calculatorCloseBtn');
      const body = document.body;

      // Open calculator
      const openCalculator = (e) => {
        if (e) e.preventDefault();
        calculatorSection.classList.add('active');
        body.style.overflow = 'hidden';
        calculatorSection.scrollTop = 0;
      };

      // Close calculator
      const closeCalculator = (e) => {
        if (e) e.preventDefault();
        calculatorSection.classList.remove('active');
        body.style.overflow = '';
      };

      // Event listeners
      if (calculatorNavBtn) {
        calculatorNavBtn.addEventListener('click', openCalculator);
      }

      // Hero calculator button
      const heroCalculatorBtn = document.getElementById('heroCalculatorBtn');
      if (heroCalculatorBtn) {
        heroCalculatorBtn.addEventListener('click', openCalculator);
      }

      // All calculator open buttons
      // Кнопки "Рассчитать стоимость" теперь открывают простую форму заявки
      const calculatorOpenBtns = document.querySelectorAll('.calculator-open-btn');
      calculatorOpenBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          // Открываем простую форму заявки вместо калькулятора
          openApplicationModal(e);
        });
      });

      if (calculatorCloseBtn) {
        calculatorCloseBtn.addEventListener('click', closeCalculator);
      }

      // Close on Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && calculatorSection.classList.contains('active')) {
          closeCalculator();
        }
      });

      // Close on click outside
      calculatorSection.addEventListener('click', (e) => {
        if (e.target === calculatorSection) {
          closeCalculator();
        }
      });
    };

    // Application Modal Toggle Functionality
    const handleApplicationModal = () => {
      const orderModal = document.getElementById('orderModal');
      const orderModalOverlay = document.getElementById('orderModalOverlay');
      const orderModalClose = document.getElementById('orderModalClose');
      const orderCancel = document.getElementById('orderCancel');
      const body = document.body;

      // Open application modal
      const openApplicationModal = (e) => {
        if (e) e.preventDefault();
        if (orderModal) {
          orderModal.style.display = 'flex';
          body.classList.add('no-scroll');
          
          // Простая форма заявки - очищаем все поля кроме основных
          const orderName = document.getElementById('orderName');
          const orderPhone = document.getElementById('orderPhone');
          const orderEmail = document.getElementById('orderEmail');
          const orderComment = document.getElementById('orderComment');
          const orderCar = document.getElementById('orderCar');
          const orderZones = document.getElementById('orderZones');
          const orderTotal = document.getElementById('orderTotal');
          
          // Очищаем все поля
          if (orderName) orderName.value = '';
          if (orderPhone) orderPhone.value = '';
          if (orderEmail) orderEmail.value = '';
          if (orderComment) orderComment.value = '';
          
          // Скрываем и очищаем поля калькулятора (авто, зоны, стоимость)
          if (orderCar) {
            orderCar.value = '';
            orderCar.parentElement.style.display = 'none';
          }
          if (orderZones) {
            orderZones.value = '';
            orderZones.parentElement.style.display = 'none';
          }
          if (orderTotal) {
            orderTotal.value = '';
            orderTotal.parentElement.style.display = 'none';
          }
          
          // Анимация появления
          gsap.fromTo(orderModal, 
            { opacity: 0 }, 
            { opacity: 1, duration: 0.3, ease: 'power2.out' }
          );
        }
      };

      // Close application modal
      const closeApplicationModal = (e) => {
        if (e) e.preventDefault();
        if (orderModal) {
          gsap.to(orderModal, {
            opacity: 0,
            duration: 0.3,
            ease: 'power2.out',
            onComplete: () => {
              orderModal.style.display = 'none';
              body.classList.remove('no-scroll');
            }
          });
        }
      };

      // All application open buttons
      const applicationOpenBtns = document.querySelectorAll('.application-open-btn');
      applicationOpenBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          openApplicationModal(e);
        });
      });

      // Discount Modal Toggle Functionality
      const handleDiscountModal = () => {
        const discountModal = document.getElementById('discountModal');
        const discountModalOverlay = document.getElementById('discountModalOverlay');
        const discountModalClose = document.getElementById('discountModalClose');
        const discountCancel = document.getElementById('discountCancel');
        const body = document.body;

        // Open discount modal
        const openDiscountModal = (e) => {
          if (e) e.preventDefault();
          if (discountModal) {
            discountModal.style.display = 'flex';
            body.classList.add('no-scroll');
            
            // Анимация появления
            gsap.fromTo(discountModal, 
              { opacity: 0 }, 
              { opacity: 1, duration: 0.3, ease: 'power2.out' }
            );
          }
        };

        // Close discount modal
        const closeDiscountModal = (e) => {
          if (e) e.preventDefault();
          if (discountModal) {
            gsap.to(discountModal, {
              opacity: 0,
              duration: 0.3,
              ease: 'power2.out',
              onComplete: () => {
                discountModal.style.display = 'none';
                body.classList.remove('no-scroll');
              }
            });
          }
        };

        // All discount open buttons
        // Кнопки "Получить скидку" также открывают простую форму заявки
        const discountOpenBtns = document.querySelectorAll('.discount-open-btn');
        discountOpenBtns.forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.preventDefault();
            // Открываем простую форму заявки
            openApplicationModal(e);
          });
        });

        // Close buttons
        if (discountModalClose) {
          discountModalClose.addEventListener('click', closeDiscountModal);
        }
        
        if (discountCancel) {
          discountCancel.addEventListener('click', closeDiscountModal);
        }

        if (discountModalOverlay) {
          discountModalOverlay.addEventListener('click', closeDiscountModal);
        }

        // Close on Escape key
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && discountModal && discountModal.style.display === 'flex') {
            closeDiscountModal();
          }
        });
      };

      // Initialize discount modal
      handleDiscountModal();

      // Close buttons
      if (orderModalClose) {
        orderModalClose.addEventListener('click', closeApplicationModal);
      }
      
      if (orderCancel) {
        orderCancel.addEventListener('click', closeApplicationModal);
      }

      if (orderModalOverlay) {
        orderModalOverlay.addEventListener('click', closeApplicationModal);
      }

      // Close on Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && orderModal && orderModal.style.display === 'flex') {
          closeApplicationModal();
        }
      });
    };

    // Video Play Button Handler - Rutube
    const handleVideoPlay = () => {
      const videoPlayBtn = document.getElementById('videoPlayBtn');
      const videoRutubeContainer = document.getElementById('videoRutubeContainer');
      const videoOverlay = document.getElementById('videoOverlay');
      const videoContent = document.getElementById('videoContent');
      
      if (!videoPlayBtn) {
        console.error('Кнопка videoPlayBtn не найдена');
        return;
      }
      
      // Добавляем обработчик клика на кнопку
      const handleVideoClick = (e) => {
        e.preventDefault();
        e.stopPropagation();
        console.log('Кнопка нажата, показываем Rutube видео');
        
        // Проверяем, мобильное ли устройство
        const isMobile = window.innerWidth <= 768;
        
        if (isMobile) {
          // На мобильных показываем мобильный контейнер
          const videoMobileContainer = document.getElementById('videoMobileContainer');
          if (videoMobileContainer) {
            videoMobileContainer.style.display = 'block';
            videoMobileContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
          // Скрываем overlay и контент
          if (videoOverlay) videoOverlay.style.display = 'none';
          if (videoContent) videoContent.style.display = 'none';
          if (videoPlayBtn) videoPlayBtn.style.display = 'none';
          return;
        }
        
        // Показываем Rutube iframe для десктопа
        if (videoRutubeContainer) {
          videoRutubeContainer.style.display = 'block';
          videoRutubeContainer.style.zIndex = '1000';
        }
        
        // Скрываем overlay и контент с анимацией
        if (videoOverlay && videoContent) {
          if (typeof gsap !== 'undefined') {
            gsap.to([videoOverlay, videoContent], {
              opacity: 0,
              duration: 0.5,
              ease: 'power2.out',
              onComplete: () => {
                if (videoOverlay) videoOverlay.style.display = 'none';
                if (videoContent) videoContent.style.display = 'none';
              }
            });
          } else {
            // Fallback если GSAP не загружен
            videoOverlay.style.opacity = '0';
            videoContent.style.opacity = '0';
            setTimeout(() => {
              if (videoOverlay) videoOverlay.style.display = 'none';
              if (videoContent) videoContent.style.display = 'none';
            }, 500);
          }
        }
        
        // Скрываем кнопку
        if (videoPlayBtn) {
        videoPlayBtn.style.display = 'none';
        }
      };
      
      // Удаляем старые обработчики
      const newBtn = videoPlayBtn.cloneNode(true);
      videoPlayBtn.parentNode.replaceChild(newBtn, videoPlayBtn);
      const btn = newBtn;
      
      btn.addEventListener('click', handleVideoClick, true);
      btn.addEventListener('touchstart', handleVideoClick, { passive: false });
      btn.onclick = handleVideoClick;
    };

    // ============================================
    // НОВЫЙ ПРЕМИУМ МОБИЛЬНЫЙ КАЛЬКУЛЯТОР
    // ============================================
    const initMobileCalculator = () => {
      if (!window.calculator) {
        setTimeout(initMobileCalculator, 100);
        return;
      }

      const wizard = document.querySelector('.mobile-wizard-new');
      if (!wizard) return; // Старая версия - пропускаем

      const steps = wizard.querySelectorAll('.mobile-wizard-step');
      let currentStep = 0; // Начинаем с шага 0 (выбор класса)
      const totalSteps = 4;

      // Элементы управления
      const footerPrev = document.getElementById('mobileFooterPrev');
      const footerNext = document.getElementById('mobileFooterNext');
      const footerTotal = document.getElementById('mobileFooterTotal');

      // Функция показа шага с анимацией
      const showStep = (stepNum, direction = 'next') => {
        steps.forEach((step, index) => {
          const stepNumber = parseInt(step.dataset.step);
          step.classList.remove('active', 'prev', 'next');
          
          if (stepNumber === stepNum) {
            step.classList.add('active', direction);
            setTimeout(() => step.classList.remove('prev', 'next'), 300);
          }
        });

        // Управление кнопками
        if (footerPrev) {
          footerPrev.style.display = stepNum === 0 ? 'none' : 'flex';
        }
        if (footerNext) {
          footerNext.style.display = stepNum === totalSteps ? 'none' : 'flex';
        }

        // Инициализация шага
        initStep(stepNum);
        updateTotalPrice();
      };

      // Инициализация конкретного шага
      const initStep = (stepNum) => {
        switch(stepNum) {
          case 0: initStep0(); break;
          case 1: initStep1(); break;
          case 2: initStep2(); break;
          case 3: initStep3(); break;
          case 4: initStep4(); break;
        }
      };
      
      // Шаг 0: Выбор класса автомобиля
      const initStep0 = () => {
        const classSelection = document.getElementById('mobileClassSelection');
        if (!classSelection || !window.calculator) return;
        
        const classes = [
          { id: 'small', name: 'Малый класс' },
          { id: 'business', name: 'Бизнес класс / Кроссоверы' },
          { id: 'suv-lux', name: 'Внедорожники / Люкс' },
          { id: 'pickup', name: 'Большие пикапы' },
          { id: 'bus', name: 'Автобусы / Минивэны' }
        ];
        
        classSelection.innerHTML = classes.map(cls => `
          <button class="mobile-class-option ${window.calculator.selectedClass === cls.id ? 'active' : ''}" 
                  data-class="${cls.id}"
                  tabindex="0">
            <span class="mobile-class-name">${cls.name}</span>
          </button>
        `).join('');
        
        classSelection.querySelectorAll('.mobile-class-option').forEach(btn => {
          btn.addEventListener('click', () => {
            const classId = btn.dataset.class;
            window.calculator.selectedClass = classId;
            window.calculator.selectClass(classId);
            
            // Обновляем активный класс
            classSelection.querySelectorAll('.mobile-class-option').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Автоматически переходим на шаг 1 (выбор марки)
            setTimeout(() => {
              currentStep = 1;
              showStep(1, 'next');
            }, 300);
          });
        });
      };

      // Шаг 1: Выбор марки (горизонтальные чипсы)
      const initStep1 = () => {
        const chipsContainer = document.getElementById('mobileBrandsChips');
        const searchInput = document.getElementById('mobileBrandSearch');
        if (!chipsContainer || !window.calculator) return;

        let searchQuery = '';
        let brandClickHandlers = [];

        const renderBrands = () => {
          let brands = window.calculator.getAllBrands();
          
          if (!brands || brands.length === 0) {
            chipsContainer.innerHTML = '<div class="mobile-chips-empty">Марки не найдены</div>';
            return;
          }
          
          // Фильтруем по поиску, если есть
          if (searchQuery) {
            brands = brands.filter(b => 
              b.toLowerCase().includes(searchQuery.toLowerCase())
            );
          }

          if (brands.length === 0) {
            chipsContainer.innerHTML = '<div class="mobile-chips-empty">По вашему запросу ничего не найдено</div>';
            return;
          }

          // Очищаем старые обработчики
          brandClickHandlers.forEach(handler => {
            if (handler.element && handler.element.removeEventListener) {
              handler.element.removeEventListener('click', handler.fn);
            }
          });
          brandClickHandlers = [];

          chipsContainer.innerHTML = brands.map(brand => `
            <button class="mobile-chip ${window.calculator.selectedBrand === brand ? 'active' : ''}" 
                    data-brand="${brand}"
                    tabindex="0">
              ${brand}
            </button>
          `).join('');

          // Обработчики клика на чипсы марок
          chipsContainer.querySelectorAll('.mobile-chip').forEach(chip => {
            const handleBrandClick = () => {
              const brand = chip.dataset.brand;
              
              // Устанавливаем выбранную марку
              window.calculator.selectedBrand = brand;
              window.calculator.selectedModel = null;
              window.calculator.selectedZones.clear();
              
              // Обновляем активный чип
              chipsContainer.querySelectorAll('.mobile-chip').forEach(c => c.classList.remove('active'));
              chip.classList.add('active');
              
              // Очищаем поиск
              if (searchInput) {
                searchInput.value = '';
                searchQuery = '';
              }
              
              updateTotalPrice();
              
              // Автоматически подтягиваем модели и переходим на шаг 2
              setTimeout(() => {
                currentStep = 2;
                showStep(2, 'next');
              }, 300);
            };
            
            chip.addEventListener('click', handleBrandClick);
            brandClickHandlers.push({ element: chip, fn: handleBrandClick });
          });
        };

        // Инициализация: показываем все марки
        renderBrands();

        // Поиск с debounce - фильтрует чипсы
        if (searchInput) {
          let searchTimeout;
          searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchQuery = e.target.value;
            searchTimeout = setTimeout(() => {
              renderBrands();
            }, 200);
          });
        }
      };

      // Шаг 2: Выбор модели (горизонтальные чипсы) - автоматически подтягиваются после выбора марки
      const initStep2 = () => {
        const chipsContainer = document.getElementById('mobileModelsChips');
        const selectedBrandEl = document.getElementById('mobileSelectedBrand');
        const classBadge = document.getElementById('mobileClassBadge');
        const classNameEl = document.getElementById('mobileClassName');
        const searchInput = document.getElementById('mobileModelSearch');
        
        if (!chipsContainer || !window.calculator || !window.calculator.selectedBrand) {
          // Если нет бренда, возвращаемся на шаг 1
          currentStep = 1;
          showStep(1);
          return;
        }

        // Показываем выбранный бренд
        if (selectedBrandEl) {
          selectedBrandEl.textContent = `Выбрана марка: ${window.calculator.selectedBrand}`;
        }

        let searchQuery = '';
        let modelClickHandlers = [];

        const renderModels = () => {
          // Автоматически подтягиваем модели для выбранной марки
          let models = window.calculator.getAllModelsForBrand(window.calculator.selectedBrand);
          
          if (!models || models.length === 0) {
            chipsContainer.innerHTML = '<div class="mobile-chips-empty">Модели не найдены для выбранной марки</div>';
            return;
          }
          
          // Фильтруем по поиску, если есть
          if (searchQuery) {
            models = models.filter(m => 
              m.toLowerCase().includes(searchQuery.toLowerCase())
            );
          }
          
          if (models.length === 0) {
            chipsContainer.innerHTML = '<div class="mobile-chips-empty">По вашему запросу ничего не найдено</div>';
            return;
          }
          
          // Очищаем старые обработчики
          modelClickHandlers.forEach(handler => {
            if (handler.element && handler.element.removeEventListener) {
              handler.element.removeEventListener('click', handler.fn);
            }
          });
          modelClickHandlers = [];
        
        chipsContainer.innerHTML = models.map(model => `
          <button class="mobile-chip ${window.calculator.selectedModel === model ? 'active' : ''}" 
                    data-model="${model}"
                    tabindex="0">
            ${model}
          </button>
        `).join('');

          // Обработчики клика на чипсы моделей
        chipsContainer.querySelectorAll('.mobile-chip').forEach(chip => {
            const handleModelClick = () => {
            const model = chip.dataset.model;
              
              // Устанавливаем выбранную модель
            window.calculator.selectModel(window.calculator.selectedBrand, model);
            window.calculator.selectedZones.clear();
            
            // Обновляем активный чип
            chipsContainer.querySelectorAll('.mobile-chip').forEach(c => c.classList.remove('active'));
            chip.classList.add('active');
            
              // Очищаем поиск
              if (searchInput) {
                searchInput.value = '';
                searchQuery = '';
              }
              
              // Показываем класс автомобиля
            if (classBadge && classNameEl && window.calculator.selectedClass) {
              const classNames = {
                'small': 'Малый класс',
                'business': 'Бизнес класс / Кроссоверы',
                'suv-lux': 'Внедорожники / Люкс',
                'pickup': 'Большие пикапы',
                'bus': 'Автобусы / Минивэны'
              };
              classNameEl.textContent = classNames[window.calculator.selectedClass] || window.calculator.selectedClass;
              classBadge.style.display = 'flex';
            }
            
            updateTotalPrice();
            
            // Автоматический переход на шаг 3
            setTimeout(() => {
              currentStep = 3;
              showStep(3, 'next');
            }, 300);
            };
            
            chip.addEventListener('click', handleModelClick);
            modelClickHandlers.push({ element: chip, fn: handleModelClick });
          });
        };

        // Автоматически подтягиваем и показываем модели при инициализации шага 2
        renderModels();

        // Поиск с debounce - фильтрует чипсы моделей
        if (searchInput) {
          let searchTimeout;
          searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchQuery = e.target.value;
            searchTimeout = setTimeout(() => {
              renderModels();
            }, 200);
          });
          
          // Очищаем поиск при инициализации
          searchInput.value = '';
        }
      };

      // Шаг 3: Выбор услуги (пакеты или зоны)
      const initStep3 = () => {
        const packagesSection = document.getElementById('mobilePackagesSection');
        const packagesGrid = document.getElementById('mobilePackagesGrid');
        const zonesSection = document.getElementById('mobileZonesSection');
        const zonesList = document.getElementById('mobileZonesList');
        const selectedCarEl = document.getElementById('mobileSelectedCar');
        
        if (!window.calculator || !window.calculator.selectedClass) {
          currentStep = 0;
          showStep(0);
          return;
        }

        // Показываем выбранный автомобиль
        if (selectedCarEl) {
          const brand = window.calculator.selectedBrand || '';
          const model = window.calculator.selectedModel || '';
          selectedCarEl.textContent = `${brand} ${model}`.trim() || 'Не выбран';
        }

        const classToUse = window.calculator.selectedClass;
        const zonesData = window.calculator.zonesDatabase[classToUse];
        
        if (!zonesData) return;

        // Рендерим пакеты
        if (packagesGrid && zonesData['Пакеты услуг']) {
          packagesGrid.innerHTML = zonesData['Пакеты услуг'].map(pkg => {
            const isSelected = window.calculator.selectedZones.has(pkg.id);
            return `
              <div class="mobile-package-card ${isSelected ? 'active' : ''}" data-package="${pkg.id}">
                <div class="mobile-package-name">${pkg.name}</div>
                <div class="mobile-package-price">${pkg.price.toLocaleString('ru-RU')} ₽</div>
              </div>
            `;
          }).join('');

          // Обработчики пакетов
          packagesGrid.querySelectorAll('.mobile-package-card').forEach(card => {
            card.addEventListener('click', () => {
              const packageId = card.dataset.package;
              const selectedPackage = zonesData['Пакеты услуг'].find(p => p.id === packageId);
              
              if (!selectedPackage || !window.calculator) return;
              
              // Очищаем все выбранные зоны
              window.calculator.selectedZones.clear();
              
              // Добавляем пакет
              window.calculator.selectedZones.add(packageId);
              window.calculator.selectedPackage = packageId;
              
              // Получаем зоны пакета через функцию getPackageZones
              const packageZones = window.calculator.getPackageZones(packageId);
              
              // Добавляем зоны пакета в selectedZones для визуального отображения
              packageZones.forEach(zoneId => {
                window.calculator.selectedZones.add(zoneId);
              });
              
              // Обновляем визуальное состояние пакетов
              packagesGrid.querySelectorAll('.mobile-package-card').forEach(c => c.classList.remove('active'));
              card.classList.add('active');
              
              // Обновляем чекбоксы зон - помечаем зоны пакета как выбранные
              if (zonesList) {
                zonesList.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                  const zoneId = checkbox.value;
                  const item = checkbox.closest('.mobile-zone-item-new');
                  
                  if (packageZones.includes(zoneId)) {
                    checkbox.checked = true;
                    item?.classList.add('active');
                  } else {
                    checkbox.checked = false;
                    item?.classList.remove('active');
                  }
                });
              }
              
              updateTotalPrice();
              
              // Показываем кнопку "Записаться на оклейку"
              const orderBtn = document.getElementById('mobileStep3OrderBtn');
              if (orderBtn) {
                orderBtn.style.display = 'block';
              }
            });
          });
        }

        // Рендерим зоны
        if (zonesList) {
          let zonesHtml = '';
          Object.entries(zonesData).forEach(([category, zones]) => {
            if (category === 'Пакеты услуг' || !Array.isArray(zones)) return;
            
            zones.forEach(zone => {
              if (zone.type === 'package') return;
              const isSelected = window.calculator.selectedZones.has(zone.id);
              zonesHtml += `
                <label class="mobile-zone-item-new ${isSelected ? 'active' : ''}">
                  <input type="checkbox" value="${zone.id}" ${isSelected ? 'checked' : ''}>
                  <span class="mobile-zone-name">${zone.name}</span>
                  <span class="mobile-zone-price-new">${zone.price.toLocaleString('ru-RU')} ₽</span>
                </label>
              `;
            });
          });
          
          zonesList.innerHTML = zonesHtml;

          // Обработчики зон
          zonesList.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', (e) => {
              const zoneId = e.target.value;
              const item = e.target.closest('.mobile-zone-item-new');
              
              // Если выбрана зона, снимаем пакеты
              if (e.target.checked) {
                // Удаляем все пакеты
                if (zonesData['Пакеты услуг']) {
                  zonesData['Пакеты услуг'].forEach(pkg => {
                    window.calculator.selectedZones.delete(pkg.id);
                  });
                }
                if (packagesGrid) {
                  packagesGrid.querySelectorAll('.mobile-package-card').forEach(c => c.classList.remove('active'));
                }
                
                window.calculator.selectedZones.add(zoneId);
                item?.classList.add('active');
              } else {
                window.calculator.selectedZones.delete(zoneId);
                item?.classList.remove('active');
              }
              
              // Показываем кнопку "Записаться на оклейку" если есть выбранные зоны
              const orderBtn = document.getElementById('mobileStep3OrderBtn');
              if (orderBtn) {
                orderBtn.style.display = window.calculator.selectedZones.size > 0 ? 'block' : 'none';
              }
              
              updateTotalPrice();
              
              // Показываем зоны
              if (zonesSection) zonesSection.style.display = 'block';
            });
          });
        }

        // Обработчик кнопки "Записаться на оклейку" на шаге 3
        // Удаляем старые обработчики перед добавлением новых
        const orderBtn = document.getElementById('mobileStep3OrderBtn');
        if (orderBtn) {
          // Клонируем кнопку для удаления всех старых обработчиков
          const newOrderBtn = orderBtn.cloneNode(true);
          orderBtn.parentNode.replaceChild(newOrderBtn, orderBtn);
          
          // Добавляем обработчик на клонированную кнопку
          const handleOrderClick = (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            console.log('Кнопка "Записаться на оклейку" нажата');
            console.log('Выбранные зоны:', Array.from(window.calculator?.selectedZones || []));
            
            if (window.calculator && window.calculator.selectedZones.size > 0) {
              console.log('Переход на шаг 4');
              // Автоматический переход на шаг 4 с формой
              currentStep = 4;
              showStep(4, 'next');
              
              // Инициализируем форму после небольшой задержки для плавного перехода
              setTimeout(() => {
                initStep4();
              }, 350);
            } else {
              console.warn('Нет выбранных зон');
              alert('Пожалуйста, выберите услугу или зону оклейки');
            }
          };
          
          // Добавляем обработчики разными способами для надежности
          newOrderBtn.addEventListener('click', handleOrderClick, true);
          newOrderBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleOrderClick(e);
          }, { passive: false });
          newOrderBtn.onclick = handleOrderClick;
        }
      };

      // Шаг 4: Итог и форма заказа
      const initStep4 = () => {
        const summaryBrand = document.getElementById('summaryBrand');
        const summaryModel = document.getElementById('summaryModel');
        const summaryClass = document.getElementById('summaryClass');
        const summaryService = document.getElementById('summaryService');
        const summaryTotal = document.getElementById('summaryTotal');
        
        if (!window.calculator) return;

        // Заполняем итоговую информацию
        if (summaryBrand) {
          summaryBrand.textContent = window.calculator.selectedBrand || '—';
        }
        if (summaryModel) {
          summaryModel.textContent = window.calculator.selectedModel || '—';
        }
        if (summaryClass && window.calculator.selectedClass) {
          const classNames = {
            'small': 'Малый класс',
            'business': 'Бизнес класс / Кроссоверы',
            'suv-lux': 'Внедорожники / Люкс',
            'pickup': 'Большие пикапы',
            'bus': 'Автобусы / Минивэны'
          };
          summaryClass.textContent = classNames[window.calculator.selectedClass] || window.calculator.selectedClass;
        }
        
        // Определяем выбранную услугу
        if (summaryService) {
          const classToUse = window.calculator.selectedClass;
          const zonesData = window.calculator.zonesDatabase[classToUse];
          let serviceText = '—';
          
          if (zonesData && zonesData['Пакеты услуг']) {
            const selectedPackage = zonesData['Пакеты услуг'].find(pkg => 
              window.calculator.selectedZones.has(pkg.id)
            );
            if (selectedPackage) {
              serviceText = selectedPackage.name;
            } else {
              // Перечисляем выбранные зоны
              const allZones = Object.values(zonesData).flat();
              const selectedZonesNames = Array.from(window.calculator.selectedZones)
                .map(zoneId => {
                  const zone = allZones.find(z => z.id === zoneId);
                  return zone ? zone.name : null;
                })
                .filter(Boolean);
              serviceText = selectedZonesNames.length > 0 
                ? selectedZonesNames.join(', ') 
                : '—';
            }
          }
          summaryService.textContent = serviceText;
        }
        
        updateTotalPrice();
        if (summaryTotal) {
          summaryTotal.textContent = footerTotal?.textContent || '0 ₽';
        }

        // Заполняем поля формы данными из калькулятора
        const orderCarInput = document.getElementById('mobileOrderCar');
        const orderServicesInput = document.getElementById('mobileOrderServices');
        const orderTotalInput = document.getElementById('mobileOrderTotal');
        
        if (orderCarInput && window.calculator) {
          const brand = window.calculator.selectedBrand || '';
          const model = window.calculator.selectedModel || '';
          let carText = `${brand} ${model}`.trim() || 'Не выбран';
          // Добавляем класс если есть
          if (window.calculator.selectedClass) {
            const classNames = {
              'small': 'Малый класс',
              'business': 'Бизнес класс / Кроссоверы',
              'suv-lux': 'Внедорожники / Люкс',
              'pickup': 'Большие пикапы',
              'bus': 'Автобусы / Минивэны'
            };
            const className = classNames[window.calculator.selectedClass] || '';
            if (className) carText += ` (${className})`;
          }
          orderCarInput.value = carText;
        }

        // Заполняем выбранные услуги
        if (orderServicesInput && window.calculator) {
          const classToUse = window.calculator.selectedClass;
          const zonesData = window.calculator.zonesDatabase[classToUse];
          let servicesText = '—';
          
          if (zonesData && zonesData['Пакеты услуг']) {
            const selectedPackage = zonesData['Пакеты услуг'].find(pkg => 
              window.calculator.selectedZones.has(pkg.id)
            );
            if (selectedPackage) {
              servicesText = selectedPackage.name;
            } else {
              // Перечисляем выбранные зоны
              const allZones = Object.values(zonesData).flat();
              const selectedZonesNames = Array.from(window.calculator.selectedZones)
                .map(zoneId => {
                  const zone = allZones.find(z => z.id === zoneId);
                  return zone ? zone.name : null;
                })
                .filter(Boolean);
              servicesText = selectedZonesNames.length > 0 
                ? selectedZonesNames.join(', ') 
                : '—';
            }
          }
          orderServicesInput.value = servicesText;
        }
        
        if (orderTotalInput && summaryTotal) {
          orderTotalInput.value = summaryTotal.textContent || '0 ₽';
        }

        // Обработчик формы заказа
        const orderForm = document.getElementById('mobileOrderForm');
        const submitBtn = document.getElementById('mobileOrderSubmitBtn');
        
        if (orderForm && submitBtn) {
          orderForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Блокируем кнопку отправки
            submitBtn.disabled = true;
            submitBtn.textContent = 'Отправка...';
            
            const formData = {
              name: document.getElementById('mobileOrderName').value,
              phone: document.getElementById('mobileOrderPhone').value,
              email: document.getElementById('mobileOrderEmail').value,
              car: document.getElementById('mobileOrderCar').value,
              total: document.getElementById('mobileOrderTotal').value,
              services: document.getElementById('mobileOrderServices')?.value || summaryService?.textContent || '—',
              zones: summaryService?.textContent || '—',
              comment: document.getElementById('mobileOrderComment').value
            };

            try {
              // Здесь можно добавить отправку данных на сервер
              // const response = await fetch('/api/order', {
              //   method: 'POST',
              //   headers: { 'Content-Type': 'application/json' },
              //   body: JSON.stringify(formData)
              // });
              
              // Пока просто логируем
              console.log('Отправка заявки:', formData);
              
              // Имитация отправки
              await new Promise(resolve => setTimeout(resolve, 1000));
              
              // Показываем сообщение об успехе
              submitBtn.textContent = '✓ Отправлено!';
              submitBtn.style.background = 'rgba(34, 197, 94, 0.2)';
              submitBtn.style.borderColor = '#22c55e';
              submitBtn.style.color = '#22c55e';
              
              // Очищаем форму
              orderForm.reset();
              
              // Через 3 секунды возвращаем кнопку в исходное состояние
              setTimeout(() => {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Отправить заявку';
                submitBtn.style.background = '';
                submitBtn.style.borderColor = '';
                submitBtn.style.color = '';
              }, 3000);
              
            } catch (error) {
              console.error('Ошибка отправки заявки:', error);
              submitBtn.textContent = 'Ошибка. Попробуйте снова';
              submitBtn.style.background = 'rgba(239, 68, 68, 0.2)';
              submitBtn.style.borderColor = '#ef4444';
              submitBtn.style.color = '#ef4444';
              
              setTimeout(() => {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Отправить заявку';
                submitBtn.style.background = '';
                submitBtn.style.borderColor = '';
                submitBtn.style.color = '';
              }, 3000);
            }
          });
        }
      };

      // Обновление итоговой цены
      const updateTotalPrice = () => {
        if (!window.calculator || !footerTotal) return;

        let total = 0;
        const classToUse = window.calculator.selectedClass;
        
        if (!classToUse) {
          footerTotal.textContent = '0 ₽';
          return;
        }

        const zonesData = window.calculator.zonesDatabase[classToUse];
        if (!zonesData) {
          footerTotal.textContent = '0 ₽';
          return;
        }

        const allZones = Object.values(zonesData).flat();
        const packages = zonesData['Пакеты услуг'] || [];
        
        // Проверяем пакеты
        let hasPackage = false;
        packages.forEach(pkg => {
          if (window.calculator.selectedZones.has(pkg.id)) {
            total = pkg.price;
            hasPackage = true;
          }
        });

        // Если нет пакета, считаем зоны
        if (!hasPackage) {
          window.calculator.selectedZones.forEach(zoneId => {
            const zone = allZones.find(z => z.id === zoneId);
            if (zone && zone.type !== 'package') {
              total += zone.price;
            }
          });
        }

        footerTotal.textContent = `${total.toLocaleString('ru-RU')} ₽`;
        
        // Также обновляем цену на шаге 3, если она там отображается
        const step3Total = document.getElementById('mobileStep3Total');
        if (step3Total) {
          step3Total.textContent = `${total.toLocaleString('ru-RU')} ₽`;
        }
        
        // Показываем кнопку "Записаться на оклейку" если цена больше 0 и мы на шаге 3
        if (currentStep === 3 && total > 0) {
          const orderBtn = document.getElementById('mobileStep3OrderBtn');
          if (orderBtn) {
            orderBtn.style.display = 'block';
          }
        }
      };

      // Навигация
      if (footerPrev) {
        footerPrev.addEventListener('click', () => {
          if (currentStep > 0) {
            currentStep--;
            showStep(currentStep, 'prev');
          }
        });
      }

      if (footerNext) {
        footerNext.addEventListener('click', () => {
          // Проверяем возможность перехода
          let canProceed = false;
          
          switch(currentStep) {
            case 0:
              canProceed = !!window.calculator.selectedClass;
              break;
            case 1:
              canProceed = !!window.calculator.selectedBrand;
              break;
            case 2:
              canProceed = !!window.calculator.selectedModel;
              break;
            case 3:
              canProceed = window.calculator.selectedZones.size > 0;
              break;
            case 4:
              canProceed = true; // Итог - всегда можно
              break;
          }

          if (canProceed && currentStep < totalSteps) {
            currentStep++;
            showStep(currentStep, 'next');
          }
        });
      }


      // Инициализация при открытии калькулятора
      const calculatorSection = document.getElementById('calculator');
      if (calculatorSection) {
        const observer = new MutationObserver(() => {
          if (calculatorSection.classList.contains('active')) {
            // Сбрасываем выбор при открытии
            if (window.calculator) {
              window.calculator.selectedBrand = null;
              window.calculator.selectedModel = null;
              window.calculator.selectedClass = null;
              window.calculator.selectedZones.clear();
            }
            
            // Сбрасываем поиск
            const brandSearch = document.getElementById('mobileBrandSearch');
            const modelSearch = document.getElementById('mobileModelSearch');
            if (brandSearch) brandSearch.value = '';
            if (modelSearch) modelSearch.value = '';
            
            // Скрываем бейдж класса
            const classBadge = document.getElementById('mobileClassBadge');
            if (classBadge) classBadge.style.display = 'none';
            
            currentStep = 1;
            showStep(1);
          }
        });
        
        observer.observe(calculatorSection, {
          attributes: true,
          attributeFilter: ['class']
        });
      }

      // Начальная инициализация
      showStep(1);
    };

    // Обработчики формы калькулятора
    const handleCalculatorForm = () => {
      const calculatorForm = document.getElementById('calculatorOrderForm');
      const calculatorFormClose = document.getElementById('calculatorFormClose');
      const calcOrderCancel = document.getElementById('calcOrderCancel');
      const calculatorFormContainer = document.getElementById('calculatorApplicationForm');
      
      // Закрытие формы
      const closeCalculatorForm = (e) => {
        if (e) e.preventDefault();
        if (calculatorFormContainer) {
          calculatorFormContainer.classList.remove('active');
          calculatorFormContainer.style.display = 'none';
          document.body.style.overflow = '';
        }
        if (window.calculator && window.calculator.closeCalculatorApplicationForm) {
          window.calculator.closeCalculatorApplicationForm();
        }
      };
      
      if (calculatorFormClose) {
        calculatorFormClose.addEventListener('click', closeCalculatorForm);
      }
      
      if (calcOrderCancel) {
        calcOrderCancel.addEventListener('click', closeCalculatorForm);
      }
      
      // Обработка отправки формы
      if (calculatorForm) {
        calculatorForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          const formData = {
            name: document.getElementById('calcOrderName').value,
            phone: document.getElementById('calcOrderPhone').value,
            email: document.getElementById('calcOrderEmail').value,
            car: document.getElementById('calcOrderCar').value,
            services: document.getElementById('calcOrderServices').value,
            total: document.getElementById('calcOrderTotal').value,
            comment: document.getElementById('calcOrderComment').value
          };
          
          const submitBtn = calculatorForm.querySelector('button[type="submit"]');
          const originalText = submitBtn?.textContent;
          
          if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.textContent = 'Отправка...';
          }
          
          try {
            // Здесь можно добавить отправку данных на сервер
            // const response = await fetch('/api/order', {
            //   method: 'POST',
            //   headers: { 'Content-Type': 'application/json' },
            //   body: JSON.stringify(formData)
            // });
            
            console.log('Отправка заявки из калькулятора:', formData);
            
            // Имитация отправки
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Показываем сообщение об успехе
            if (submitBtn) {
              submitBtn.textContent = '✓ Отправлено!';
              submitBtn.style.background = 'rgba(34, 197, 94, 0.2)';
              submitBtn.style.borderColor = '#22c55e';
              submitBtn.style.color = '#22c55e';
            }
            
            // Очищаем форму
            calculatorForm.reset();
            
            // Закрываем форму через 2 секунды
            setTimeout(() => {
              closeCalculatorForm();
              if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText || 'Отправить заявку';
                submitBtn.style.background = '';
                submitBtn.style.borderColor = '';
                submitBtn.style.color = '';
              }
            }, 2000);
            
          } catch (error) {
            console.error('Ошибка отправки заявки:', error);
            if (submitBtn) {
              submitBtn.disabled = false;
              submitBtn.textContent = originalText || 'Отправить заявку';
              alert('Ошибка отправки заявки. Попробуйте еще раз.');
            }
          }
        });
      }
    };

    // Handle navigation menu toggle
    const handleNavToggle = () => {
      const navToggle = document.getElementById('navToggle');
      const navMenu = document.getElementById('navMenu');
      const body = document.body;

      if (!navToggle || !navMenu) return;

      const toggleMenu = (e) => {
        if (e) e.preventDefault();
        e?.stopPropagation();
        
        navMenu.classList.toggle('active');
        navToggle.classList.toggle('active');
        
        if (navMenu.classList.contains('active')) {
          body.style.overflow = 'hidden';
        } else {
          body.style.overflow = '';
        }
      };

      navToggle.addEventListener('click', toggleMenu);
      navToggle.addEventListener('touchstart', toggleMenu, { passive: false });
      
      // Закрываем меню при клике вне его
      const closeMenuOnOutsideClick = (e) => {
        if (navMenu.classList.contains('active') && 
            !navMenu.contains(e.target) && 
            !navToggle.contains(e.target)) {
          navMenu.classList.remove('active');
          navToggle.classList.remove('active');
          body.style.overflow = '';
        }
      };
      
      // Используем capture фазу для правильной работы
      document.addEventListener('click', closeMenuOnOutsideClick, true);

      // Обработчики для ссылок в меню
      navMenu.querySelectorAll('a').forEach(link => {
        // Удаляем старые обработчики если есть
        const newLink = link.cloneNode(true);
        link.parentNode.replaceChild(newLink, link);
        
        newLink.addEventListener('click', (e) => {
          e.stopPropagation(); // Останавливаем всплытие
          
          // Для калькулятора - открываем калькулятор и закрываем меню
          if (newLink.id === 'calculatorNavBtn') {
            e.preventDefault();
            // Закрываем меню
            navMenu.classList.remove('active');
            navToggle.classList.remove('active');
            body.style.overflow = '';
            // Открываем калькулятор
            setTimeout(() => {
              const calculatorSection = document.getElementById('calculator');
              if (calculatorSection) {
                calculatorSection.classList.add('active');
                body.style.overflow = 'hidden';
                calculatorSection.scrollTop = 0;
              }
            }, 300);
            return;
          }
          
          // Для обычных ссылок - закрываем меню после небольшой задержки для плавности
          const href = newLink.getAttribute('href');
          if (href && href !== '#' && href.startsWith('#')) {
            // Не предотвращаем переход, но закрываем меню
            setTimeout(() => {
              navMenu.classList.remove('active');
              navToggle.classList.remove('active');
              body.style.overflow = '';
            }, 100);
          } else {
            // Для остальных ссылок тоже закрываем меню
            setTimeout(() => {
              navMenu.classList.remove('active');
              navToggle.classList.remove('active');
              body.style.overflow = '';
            }, 100);
          }
        }, false);
        });
      };

    // Quick "Записаться" button with 5-second timer
    const initQuickOrderButton = () => {
      // Создаем кнопку, если её еще нет
      let quickOrderBtn = document.getElementById('quickOrderBtn');
      
      if (!quickOrderBtn) {
        quickOrderBtn = document.createElement('button');
        quickOrderBtn.id = 'quickOrderBtn';
        quickOrderBtn.className = 'quick-order-btn';
        // SVG иконка конверта вместо текста
        quickOrderBtn.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M4 4H20C21.1 4 22 4.9 22 6V18C22 19.1 21.1 20 20 20H4C2.9 20 2 19.1 2 18V6C2 4.9 2.9 4 4 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M22 6L12 13L2 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>`;
        quickOrderBtn.setAttribute('aria-label', 'Быстрая запись на оклейку');
        quickOrderBtn.setAttribute('tabindex', '0');
        document.body.appendChild(quickOrderBtn);
      }

      let lastClickTime = 0;
      const COOLDOWN_TIME = 5000; // 5 секунд

      const handleQuickOrder = (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        const currentTime = Date.now();
        const timeSinceLastClick = currentTime - lastClickTime;

        if (timeSinceLastClick < COOLDOWN_TIME) {
          return;
        }

        lastClickTime = currentTime;
        
        // Открываем ПРОСТУЮ форму заявки (без авто и цены)
        const orderModal = document.getElementById('orderModal');
        if (orderModal) {
          orderModal.style.display = 'flex';
          document.body.classList.add('no-scroll');
          
          if (typeof gsap !== 'undefined') {
            gsap.fromTo(orderModal, 
              { opacity: 0 }, 
              { opacity: 1, duration: 0.3, ease: 'power2.out' }
            );
          }
          
          // НЕ заполняем данные из калькулятора - это простая форма
          // Очищаем поля автомобиля и цены, если они есть, и скрываем их
          const orderTotal = document.getElementById('orderTotal');
          const orderCar = document.getElementById('orderCar');
          const orderZones = document.getElementById('orderZones');
          const orderName = document.getElementById('orderName');
          const orderPhone = document.getElementById('orderPhone');
          const orderEmail = document.getElementById('orderEmail');
          const orderComment = document.getElementById('orderComment');
          
          // Очищаем основные поля
          if (orderName) orderName.value = '';
          if (orderPhone) orderPhone.value = '';
          if (orderEmail) orderEmail.value = '';
          if (orderComment) orderComment.value = '';
          
          // Очищаем и скрываем поля калькулятора
          if (orderTotal) {
            orderTotal.value = '';
            orderTotal.parentElement.style.display = 'none';
          }
          if (orderCar) {
            orderCar.value = '';
            orderCar.parentElement.style.display = 'none';
          }
          if (orderZones) {
            orderZones.value = '';
            orderZones.parentElement.style.display = 'none';
          }
        }
        
        // Блокируем кнопку на 5 секунд
        quickOrderBtn.disabled = true;
        quickOrderBtn.classList.add('disabled');
        
        let countdown = 5;
        const countdownInterval = setInterval(() => {
          countdown--;
          if (countdown <= 0) {
            clearInterval(countdownInterval);
            quickOrderBtn.disabled = false;
            quickOrderBtn.classList.remove('disabled');
          }
        }, 1000);
      };

      quickOrderBtn.addEventListener('click', handleQuickOrder);
      quickOrderBtn.addEventListener('touchstart', handleQuickOrder, { passive: false });
    };

    // Плавная прокрутка для всех якорных ссылок
    const handleSmoothScroll = () => {
      // Обработка всех ссылок с якорями
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          const href = this.getAttribute('href');
          
          // Пропускаем пустые якоря и якоря для калькулятора
          if (href === '#' || href === '#calculator' || this.id === 'calculatorNavBtn') {
            return;
          }
          
          const target = document.querySelector(href);
          if (target) {
            e.preventDefault();
            
            // Закрываем мобильное меню если открыто
            const navMenu = document.getElementById('navMenu');
            const navToggle = document.getElementById('navToggle');
            if (navMenu && navMenu.classList.contains('active')) {
              navMenu.classList.remove('active');
              if (navToggle) navToggle.classList.remove('active');
            }
            
            // Вычисляем позицию с учетом фиксированной навигации
            const navHeight = document.querySelector('.main-nav')?.offsetHeight || 0;
            const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - navHeight - 20;
            
            // Плавная прокрутка
            window.scrollTo({
              top: targetPosition,
              behavior: 'smooth'
            });
          }
          });
        });
      };

    // Lightbox для галереи портфолио
    const handlePortfolioLightbox = () => {
      const lightbox = document.getElementById('portfolioLightbox');
      const lightboxImage = document.getElementById('lightboxImage');
      const lightboxCaption = document.getElementById('lightboxCaption');
      const lightboxClose = document.getElementById('lightboxClose');
      const lightboxOverlay = document.getElementById('lightboxOverlay');
      const lightboxPrev = document.getElementById('lightboxPrev');
      const lightboxNext = document.getElementById('lightboxNext');
      const portfolioItems = document.querySelectorAll('.portfolio-item[data-image]');
      
      if (!lightbox || !lightboxImage) return;
      
      let currentIndex = 0;
      const images = Array.from(portfolioItems).map(item => ({
        src: item.dataset.image,
        alt: item.dataset.alt || item.querySelector('img')?.alt || ''
      }));
      
      const openLightbox = (index) => {
        if (index < 0 || index >= images.length) return;
        
        currentIndex = index;
        lightboxImage.src = images[index].src;
        lightboxImage.alt = images[index].alt || `Портфолио ${index + 1}`;
        lightboxCaption.textContent = images[index].alt || '';
        
        lightbox.style.display = 'flex';
        lightbox.style.visibility = 'visible';
        document.body.style.overflow = 'hidden';
        
        // Убеждаемся, что кнопка закрытия видна и работает
        const closeBtn = document.getElementById('lightboxClose') || window.lightboxCloseBtn;
        if (closeBtn) {
          closeBtn.style.display = 'flex';
          closeBtn.style.visibility = 'visible';
          closeBtn.style.opacity = '1';
          closeBtn.style.zIndex = '10003';
        }
        
        // Анимация появления
        if (typeof gsap !== 'undefined') {
          gsap.fromTo(lightbox, 
            { opacity: 0 }, 
            { opacity: 1, duration: 0.3, ease: 'power2.out' }
          );
          gsap.fromTo(lightboxImage, 
            { scale: 0.8, opacity: 0 }, 
            { scale: 1, opacity: 1, duration: 0.4, ease: 'power2.out', delay: 0.1 }
          );
          if (closeBtn) {
            gsap.fromTo(closeBtn, 
              { opacity: 0, scale: 0.8 }, 
              { opacity: 1, scale: 1, duration: 0.3, ease: 'power2.out', delay: 0.2 }
            );
          }
        } else {
          if (closeBtn) {
            closeBtn.style.opacity = '1';
          }
        }
      };
      
      const closeLightbox = () => {
        // Убеждаемся, что светбокс действительно закрыт
        if (typeof gsap !== 'undefined') {
          gsap.to(lightbox, {
            opacity: 0,
            duration: 0.3,
            ease: 'power2.out',
            onComplete: () => {
              lightbox.style.display = 'none';
              lightbox.style.visibility = 'hidden';
              document.body.style.overflow = '';
              // Фокус возвращаем на элемент, который открыл lightbox
              if (document.activeElement && document.activeElement.blur) {
                document.activeElement.blur();
              }
            }
          });
        } else {
          lightbox.style.display = 'none';
          lightbox.style.visibility = 'hidden';
          document.body.style.overflow = '';
          if (document.activeElement && document.activeElement.blur) {
            document.activeElement.blur();
          }
        }
      };
      
      const showNext = () => {
        const nextIndex = (currentIndex + 1) % images.length;
        openLightbox(nextIndex);
      };
      
      const showPrev = () => {
        const prevIndex = (currentIndex - 1 + images.length) % images.length;
        openLightbox(prevIndex);
      };
      
      // Обработчики кликов на изображения
      portfolioItems.forEach((item, index) => {
        item.style.cursor = 'pointer';
        
        // Удаляем старые обработчики
        const newItem = item.cloneNode(true);
        item.parentNode.replaceChild(newItem, item);
        const portfolioItem = newItem;
        
        const handleClick = (e) => {
          e.preventDefault();
          e.stopPropagation();
          openLightbox(index);
        };
        
        portfolioItem.addEventListener('click', handleClick, true);
        portfolioItem.addEventListener('touchstart', handleClick, { passive: false });
        
        // Также добавляем на изображение внутри
        const img = portfolioItem.querySelector('img');
        if (img) {
          img.style.pointerEvents = 'none';
        }
      });
      
      // Закрытие - улучшенная обработка
      const handleCloseClick = (e) => {
        if (e) {
          e.preventDefault();
          e.stopPropagation();
        }
        closeLightbox();
      };
      
      if (lightboxClose) {
        // Удаляем старые обработчики через клонирование
        const newCloseBtn = lightboxClose.cloneNode(true);
        lightboxClose.parentNode.replaceChild(newCloseBtn, lightboxClose);
        
        // Добавляем обработчики
        newCloseBtn.addEventListener('click', handleCloseClick, true);
        newCloseBtn.addEventListener('touchstart', handleCloseClick, { passive: false });
        newCloseBtn.onclick = handleCloseClick;
        
        // Сохраняем ссылку для обновления
        window.lightboxCloseBtn = newCloseBtn;
        
        // Переопределяем openLightbox для обновления обработчика
        const originalOpen = openLightbox;
        openLightbox = function(index) {
          originalOpen.call(this, index);
          // Обновляем обработчик после открытия
          setTimeout(() => {
            if (window.lightboxCloseBtn) {
              window.lightboxCloseBtn.onclick = handleCloseClick;
            }
          }, 50);
        };
      }
      
      if (lightboxOverlay) {
        const handleOverlayClose = (e) => {
          if (e.target === lightboxOverlay || e.target === lightbox) {
            e.preventDefault();
            closeLightbox();
          }
        };
        lightboxOverlay.addEventListener('click', handleOverlayClose, true);
        lightboxOverlay.addEventListener('touchstart', handleOverlayClose, { passive: false });
      }
      
      // Навигация
      if (lightboxNext) {
        lightboxNext.addEventListener('click', (e) => {
          e.stopPropagation();
          showNext();
        });
      }
      if (lightboxPrev) {
        lightboxPrev.addEventListener('click', (e) => {
          e.stopPropagation();
          showPrev();
        });
      }
      
      // Клавиатурная навигация - улучшенная версия
      const handleKeyDown = (e) => {
        if (lightbox && (lightbox.style.display === 'flex' || lightbox.style.display === 'block' || lightbox.style.display === '')) {
          if (e.key === 'Escape') {
            e.preventDefault();
            e.stopPropagation();
            closeLightbox();
          } else if (e.key === 'ArrowRight') {
            e.preventDefault();
            showNext();
          } else if (e.key === 'ArrowLeft') {
            e.preventDefault();
            showPrev();
          }
        }
      };
      
      // Добавляем обработчик клавиатуры с capture фазой для приоритета
      document.addEventListener('keydown', handleKeyDown, true);
      
      // Свайпы для мобильных
      let touchStartX = 0;
      let touchEndX = 0;
      
      if (lightboxImage) {
        lightboxImage.addEventListener('touchstart', (e) => {
          touchStartX = e.changedTouches[0].screenX;
        }, { passive: true });
        
        lightboxImage.addEventListener('touchend', (e) => {
          touchEndX = e.changedTouches[0].screenX;
          handleSwipe();
        }, { passive: true });
      }
      
      const handleSwipe = () => {
        const swipeThreshold = 50;
        const diff = touchStartX - touchEndX;
        
        if (Math.abs(diff) > swipeThreshold) {
          if (diff > 0) {
            showNext();
          } else {
            showPrev();
          }
        }
      };
    };

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        handleNavToggle();
        handleSmoothScroll();
        handleCalculatorToggle();
        handleApplicationModal();
        handleVideoPlay();
        handleCalculatorForm();
        handlePortfolioLightbox();
        initQuickOrderButton();
        setTimeout(initMobileCalculator, 500);
      });
    } else {
      handleNavToggle();
      handleSmoothScroll();
      handleCalculatorToggle();
      handleApplicationModal();
      handleVideoPlay();
      handleCalculatorForm();
      handlePortfolioLightbox();
      initQuickOrderButton();
      setTimeout(initMobileCalculator, 500);
    }
  </script>
  <!-- Application Modal - используем существующее orderModal -->

  </body>
</html>
