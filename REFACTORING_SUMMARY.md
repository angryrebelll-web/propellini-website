# Полный рефакторинг проекта PROPELLINI

## Выполненные исправления

### 1. Модульная архитектура ✅
- Создана структура модулей: `header/`, `hero/`, `benefits/`, `calculator/`, `gallery/`, `contacts/`, `footer/`
- Создан `global.css` с базовыми стилями и переменными
- Разделены CSS и JS по модулям

### 2. Калькулятор - единый компонент ✅
- Создан `calculator-unified.js` - единый источник данных и логики
- Убраны дублирующиеся логики desktop/mobile
- Правильная инициализация после загрузки DOM
- Единый источник данных: `CALCULATOR_DATA` (бренды, модели, классы, зоны, цены)

### 3. Блокировка скролла исправлена ✅
- Создан `scroll-fix.js` - централизованная обработка скролла
- Убраны лишние `preventDefault` на `touchmove`
- Скролл блокируется только когда модальное окно открыто
- Внутри модальных окон скролл работает нормально
- Убраны конфликтующие обработчики `wheel`

### 4. Z-index наложения исправлены ✅
- Создан `z-index-fix.css` с правильной иерархией:
  - Базовые слои: z-index 1-2
  - Навигация: z-index 100
  - Модальные окна: z-index 9990-9993
  - Lightbox: z-index 9994
- Убраны фантомные контейнеры с `pointer-events: none`
- Неактивные модальные окна не перехватывают клики

### 5. Desktop калькулятор восстановлен ✅
- Правильная инициализация через `renderDesktop()`
- Рендеринг брендов, моделей, зон
- Обновление итоговой стоимости
- Связка с формой заявки

### 6. Mobile калькулятор - fullscreen wizard ✅
- 4 шага: Марка → Модель → Услуга → Итого
- Фиксированная панель "Итого" снизу
- Горизонтальные чипсы для марок/моделей
- Список зон с чекбоксами (без SVG)
- Большие CTA-кнопки (min-height: 48px)
- Swipe навигация между шагами

### 7. Навигация исправлена ✅
- Мобильная версия: светлый фон, темный логотип
- Бургер-меню работает корректно
- Закрытие по клику на ссылку/вне меню
- Desktop: прозрачный + blur до скролла 80px

### 8. Hero-блок ✅
- Фон: Mercedes AMG GT63 (desktop/mobile версии)
- Затемнение 55% через `::after`
- Параллакс для desktop (`background-attachment: fixed`)
- Отключен на mobile (`background-attachment: scroll`)
- Контрастный текст с `text-shadow`

### 9. Производительность оптимизирована ✅
- Создан `performance-optimization.css`
- Убраны лишние `box-shadow` (заменены на легкие)
- Оптимизирован `backdrop-filter` (только где нужно)
- Убраны лишние анимации на mobile
- GPU оптимизация через `will-change` и `transform: translateZ(0)`

### 10. Кнопки и модальные окна ✅
- Все кнопки "Рассчитать", "Записаться" открывают правильные модальные окна
- Форма заявки с автозаполнением из калькулятора
- Правильная блокировка скролла при открытии модалов
- Закрытие по X, Escape, клику вне формы

## Структура файлов

```
src/
├── modules/
│   ├── header/
│   │   ├── header.css
│   │   └── header.js
│   ├── hero/
│   │   └── hero.css
│   ├── benefits/
│   │   └── benefits.css
│   ├── calculator/
│   │   ├── calculator.css
│   │   ├── calculator.js (legacy)
│   │   └── calculator-unified.js (NEW - единый компонент)
│   ├── gallery/
│   │   └── gallery.css
│   ├── contacts/
│   │   └── contacts.css
│   └── footer/
│       └── footer.css
├── styles/
│   ├── global.css (NEW)
│   ├── z-index-fix.css (NEW)
│   └── performance-optimization.css (NEW)
└── js/
    ├── scroll-fix.js (NEW)
    ├── calculator-modal.js (обновлен)
    └── unified-order-form.js (обновлен)
```

## Критические исправления

1. **Скролл не блокируется вне модальных окон** - убраны глобальные `preventDefault`
2. **Кнопки работают** - исправлены z-index, убраны фантомные контейнеры
3. **Desktop калькулятор работает** - правильная инициализация, рендеринг, события
4. **Mobile не дёргается** - убраны лишние обработчики, оптимизированы анимации
5. **Производительность улучшена** - меньше blur/shadow, GPU оптимизация

## Что нужно протестировать

1. ✅ Desktop калькулятор - открытие, выбор марки/модели, зон, расчет
2. ✅ Mobile калькулятор - wizard 4 шага, swipe навигация, фиксированная панель
3. ✅ Скролл страницы - не блокируется когда модалы закрыты
4. ✅ Кнопки - все открывают правильные модальные окна
5. ✅ Навигация - мобильная версия, бургер-меню
6. ✅ Hero-блок - фон, затемнение, контрастность текста
7. ✅ Форма заявки - автозаполнение из калькулятора

## Следующие шаги (опционально)

1. Минификация CSS/JS для продакшена
2. Конвертация изображений в WebP
3. Lazy loading для изображений
4. Оптимизация шрифтов (preload, subset)

